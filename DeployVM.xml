<?xml version="1.0" encoding="UTF-8"?>
<Workflow_WorkflowDefinition apiMode="0" config="&lt;configuration />"
    description="" executeOnWeb="0"
    inputs="&lt;inputs>&lt;vmName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;hypervisorName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;vmHost class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;resourcePool class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;dataCenterName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;vmNetwork class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;dataStore class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;companyName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;ovaPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;contentLibrary class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;gatewayClientGroup class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/inputs>"
    interactive="0" isHtmlDescription="0" manualPercentageComplete="0"
    name="DeployVM"
    outputs="&lt;outputs>&lt;clientId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/outputs>"
    revision="$Revision:  $" tags=""
    uniqueGuid="0f634bfc-2c6d-4602-9716-b8146e249fed"
    variables="&lt;variables>&lt;vmPassword class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>commvault!12&lt;/vmPassword>&lt;scriptPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;scriptlogPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;failureMessage class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;vmIPAddress class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;vmSyncCount class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot;>10&lt;/vmSyncCount>&lt;dataCenterName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>SDDC-Datacenter&lt;/dataCenterName>&lt;vmHost class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>Cluster-1&lt;/vmHost>&lt;vmNetwork class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>computenetwork&lt;/vmNetwork>&lt;ovaPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>C:\OVA\commvaultappliance.ova&lt;/ovaPath>&lt;ovftoolpath class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>C:\Program Files\VMware\VMware OVF Tool\ovftool&lt;/ovftoolpath>&lt;dataStore class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>WorkloadDatastore&lt;/dataStore>&lt;resourcePool class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>Compute-ResourcePool&lt;/resourcePool>&lt;gatewayClientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;gatewayHostname class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;gatewayPort class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot; />&lt;proxiesClientGroup class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;firewallStop class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>sudo systemctl stop firewalld;sudo systemctl disable firewalld&lt;/firewallStop>&lt;scriptPath_FW class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;scriptLogPath_FW class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;unixOvfPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>ovftool&lt;/unixOvfPath>&lt;enableFirewall class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>False&lt;/enableFirewall>&lt;ovaUnixPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>/opt/ova/commvaultappliance.ova&lt;/ovaUnixPath>&lt;sessionId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;datastoreId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;datacenterId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;networkId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;resourcepoolId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;libraryId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;itemId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;networkKey class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;storagegroupKey class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;itemName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>commvaultappliance2&lt;/itemName>&lt;vmId class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;loopcount class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot;>1&lt;/loopcount>&lt;CCR class=&quot;java.lang.String&quot; _list_=&quot;true&quot; />&lt;XmlArguments class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/variables>"
    webHidden="0" workflowId="0">
    <schema>
        <outputs className="" name="outputs" type="">
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="clientId" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="clientName" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
        </outputs>
        <variables attribute="0" className="" name="variables" type="">
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="vmPassword" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="scriptPath" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="scriptlogPath" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="failureMessage" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="vmIPAddress" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.Integer"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0"
                inputType="java.lang.Integer" listType="0"
                name="vmSyncCount" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}integer"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="dataCenterName" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="vmHost" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="vmNetwork" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="ovaPath" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="ovftoolpath" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="dataStore" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="resourcePool" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="gatewayClientName" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="gatewayHostname" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.Integer"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0"
                inputType="java.lang.Integer" listType="0"
                name="gatewayPort" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}integer"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="proxiesClientGroup" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="firewallStop" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="scriptPath_FW" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="scriptLogPath_FW" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="unixOvfPath" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="enableFirewall" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="ovaUnixPath" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="sessionId" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="datastoreId" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="datacenterId" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="networkId" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="resourcepoolId" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="libraryId" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="itemId" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="networkKey" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="storagegroupKey" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="itemName" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="vmId" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.Integer"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0"
                inputType="java.lang.Integer" listType="0"
                name="loopcount" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}integer"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="1"
                name="CCR" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                hidden="0" inputType="java.lang.String" listType="0"
                name="XmlArguments" type="{http://www.w3.org/2001/XMLSchema}string"/>
        </variables>
        <inputs attribute="0" className="" name="inputs" type="">
            <children attribute="0" className="java.lang.String"
                controlHidden="0" controlType="0" defaultValue=""
                displayName="VM Name" documentation="" hidden="0"
                inputType="java.lang.String" listType="0"
                maximumValue="" minimumValue="" name="vmName"
                readOnly="0" required="1" searchable="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlHidden="0" controlType="0" defaultValue=""
                displayName="vCenter/Hypervisor Name" documentation=""
                hidden="0" inputType="java.lang.String" listType="0"
                maximumValue="" minimumValue="" name="hypervisorName"
                readOnly="0" required="1" searchable="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlHidden="0" controlType="0" defaultValue=""
                displayName="ESX/Cluster" documentation="" hidden="0"
                inputType="java.lang.String" listType="0"
                maximumValue="" minimumValue="" name="vmHost"
                readOnly="0" required="0" searchable="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlHidden="0" controlType="0" defaultValue=""
                displayName="ResourcePool" documentation="" hidden="0"
                inputType="java.lang.String" listType="0"
                maximumValue="" minimumValue="" name="resourcePool"
                readOnly="0" required="0" searchable="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlHidden="0" controlType="0" defaultValue=""
                displayName="" documentation="" hidden="0"
                inputType="java.lang.String" listType="0"
                maximumValue="" minimumValue="" name="dataCenterName"
                readOnly="0" required="0" searchable="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlHidden="0" controlType="0" defaultValue=""
                displayName="Network" documentation="" hidden="0"
                inputType="java.lang.String" listType="0"
                maximumValue="" minimumValue="" name="vmNetwork"
                readOnly="0" required="0" searchable="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlHidden="0" controlType="0" defaultValue=""
                displayName="Datastore" documentation="" hidden="0"
                inputType="java.lang.String" listType="0"
                maximumValue="" minimumValue="" name="dataStore"
                readOnly="0" required="0" searchable="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="companyName" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="ovaPath" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="contentLibrary" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
            <children attribute="0" className="java.lang.String"
                controlType="0" defaultValue="" displayName=""
                documentation="" hidden="0" inputType="java.lang.String"
                listType="0" name="gatewayClientGroup" readOnly="0" type="{http://www.w3.org/2001/XMLSchema}string"/>
        </inputs>
        <config className="" name="configuration" type=""/>
    </schema>
    <Start commented="0" continueOnFailure="0" created="0"
        description="" displayName="Start" height="36" interactive="0"
        jobMode="0" name="Start" originalStyle="" skipAttempt="0"
        style="image;image=/images/jgraphx/house.png"
        uniqueName="Start_1" waitSetting="0" width="55" x="12" y="69">
        <inputs val="&lt;inputs />"/>
        <transition activity="CommServDBQuery_3" commented="0"
            originalStyle="" points="" sourceX="39" sourceY="87"
            status="0" style="defaultEdge" targetX="165" targetY="204"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Start>
    <Activity commented="0" continueOnFailure="0"
        created="1585916810973"
        description="executes queries against a commcell database"
        displayName="Collecting VM Details" height="34" interactive="0"
        jobMode="0" name="CommServDBQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.CommServDBQuery"
        uniqueName="CommServDBQuery_1" waitSetting="0" width="149"
        x="466" y="341">
        <onExit language="1" script="if(xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}==null || xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}.length() == 0)&#xd;&#xa;{ &#xd;&#xa;workflow.setVariable(&quot;failureMessage&quot;,&quot;Invalid job&quot;);&#xd;&#xa;}&#xd;&#xa;   &#xd;&#xa;if(xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmIP&quot;]}!=null &amp;&amp; xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmIP&quot;]}.length() > 0)&#xd;&#xa;{&#xd;&#xa;    workflow.setVariable(&quot;vmIPAddress&quot;,xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmIP&quot;]});&#xd;&#xa;    workflow.setVariable(&quot;vmSyncCount&quot;,0);&#xd;&#xa;}&#xd;&#xa;    &#xd;&#xa;    "/>
        <inputs val="&lt;inputs>&lt;commCell />&lt;query>set nocount on&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;declare @csName nvarchar(1024)&amp;#xD;&#xd;&#xa;declare @csHostName nvarchar(1024)&amp;#xD;&#xd;&#xa;declare @csUserName nvarchar(1024)&amp;#xD;&#xd;&#xa;declare @csPassword nvarchar(1024)&amp;#xD;&#xd;&#xa;declare @vmID int&amp;#xD;&#xd;&#xa;declare @email nvarchar(1024)&amp;#xD;&#xd;&#xa;declare @vmName nvarchar(1024) = isnull('xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vmName&quot;]}','')&amp;#xD;&#xd;&#xa;declare @vmGUID nvarchar(1024) = isnull('xpath:{/workflow/XPathQuery_27/result}','')&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;declare @vmIP nvarchar(1024)&amp;#xD;&#xd;&#xa;declare @vmAccountName nvarchar(1024) = 'root'&amp;#xD;&#xd;&#xa;declare @vmAccountPwd nvarchar(max)&amp;#xD;&#xd;&#xa;declare @vmPolicyId int&amp;#xD;&#xd;&#xa;declare @vmOsType int = 2&amp;#xD;&#xd;&#xa;declare @vmClientname nvarchar(1024)&amp;#xD;&#xd;&#xa;DECLARE @vmClientId int&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;if (ISNULL(@vmName,'')='')&amp;#xD;&#xd;&#xa;begin &amp;#xD;&#xd;&#xa;    select 0 as status,'VMName value are empty or  VM is not availabl' as ErrorMessage&amp;#xD;&#xd;&#xa;end&amp;#xD;&#xd;&#xa;else&amp;#xD;&#xd;&#xa;begin&amp;#xD;&#xd;&#xa;     select @vmID =vm.id,&amp;#xD;&#xd;&#xa;     @vmClientname = cl.name,&amp;#xD;&#xd;&#xa;&#x9; @vmGUID = vm.GUID,&amp;#xD;&#xd;&#xa;&#x9; @vmClientId=vm.clientId,&amp;#xD;&#xd;&#xa;&#x9; @vmIP = isnull(vmIp.value('@ipAddress','nvarchar(1024)'),'')&amp;#xD;&#xd;&#xa;&#x9; from APP_VM vm inner join APP_VMHost vmh on vmh.id=vm.vHostId&amp;#xD;&#xd;&#xa;&#x9; inner join app_client cl on cl.id=vm.clientId&amp;#xD;&#xd;&#xa;&#x9; CROSS APPLY vm.vxml.nodes('/QSMServer_QVirtualMachineReq') as vmIp(vmIp) &amp;#xD;&#xd;&#xa;&#x9; where vm.guid=@vmGUID&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;-- for cs &amp;#xD;&#xd;&#xa;select @csName=cl.name,@csHostName=cl.csHostName from app_client cl where cl.id=2&amp;#xD;&#xd;&#xa;select @csUserName=us.login, @csPassword=us.password from umusers us where us.id =1&amp;#xD;&#xd;&#xa;--Getting email details&amp;#xD;&#xd;&#xa;select @email=email from umusers where id=(select attrval from app_clientprop where componentNameId=11 and attrName='Virtual Machine Created by User')&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;IF LEN(@vmIP) &amp;gt; 15 --IPv4 max len is 15&amp;#xD;&#xd;&#xa;BEGIN&#x9;&amp;#xD;&#xd;&#xa;    SET @vmIP = ''&amp;#xD;&#xd;&#xa;END&amp;#xD;&#xd;&#xa;ELSE IF ISNULL(@vmIP,'') !='' AND LEN(@vmIP) &amp;gt; 0&amp;#xD;&#xd;&#xa;BEGIN&amp;#xD;&#xd;&#xa;    update app_client set net_hostname = @vmIP where id = @vmClientId&amp;#xD;&#xd;&#xa;END &amp;#xD;&#xd;&#xa;     select @csName as 'csName', @csHostName as 'csHostName',@csUserName as 'csUsername' ,&amp;#xD;&#xd;&#xa;   @csPassword as 'csPassword',@vmClientId as 'vmClientId', @vmClientname 'vmClientname', @vmName as 'vmName',@vmIP as 'vmIP',&amp;#xD;&#xd;&#xa;   @vmOsType as 'osType',@vmClientname as 'clientName',@vmGUID as 'vmGUID' ,@email as emailId,  @vmAccountName 'vmUsername'&amp;#xD;&#xd;&#xa;end&amp;#xD;&#xd;&#xa;set nocount off&amp;#xD;&#xd;&#xa;&#x9;&lt;/query>&lt;/inputs>"/>
        <transition activity="WorkflowEnd_1" commented="0"
            displayName="Failed" originalStyle="" points=""
            sourceX="623" sourceY="88" status="0" style="defaultEdge"
            targetX="810" targetY="318" transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}==null || xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}.length() == 0;"/>
        </transition>
        <transition activity="Script_2" commented="0"
            displayName="Sucess" originalStyle="" points=""
            sourceX="682" sourceY="85" status="0" style="defaultEdge"
            targetX="675" targetY="218" transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}!=null &amp;&amp; xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}.length() > 0 &amp;&amp; xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmIP&quot;]}!=null &amp;&amp; xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmIP&quot;]}.length() > 0;"/>
        </transition>
        <transition activity="Delay_1" commented="0"
            displayName="No valid IP" originalStyle="" points=""
            sourceX="540" sourceY="358" status="0" style="defaultEdge"
            targetX="530" targetY="251" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}!=null &amp;&amp; xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}.length() > 0 &amp;&amp; (xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmIP&quot;]}==null || xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmIP&quot;]}.length() == 0);"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1586166070136"
        description="activity to execute code snippets in the selected language"
        displayName="Processing Data" height="34" interactive="0"
        jobMode="0" name="Script"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ScriptActivity"
        uniqueName="Script_2" waitSetting="0" width="124" x="786" y="236">
        <inputs val="&lt;inputs>&lt;script language=&quot;1&quot; script=&quot;String osType=&amp;quot;&amp;quot;;&amp;#xD;&amp;#xA;if(xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;osType&amp;quot;]}==2)&amp;#xD;&amp;#xA; osType=&amp;quot;Unix&amp;quot;;&amp;#xD;&amp;#xA;else osType=&amp;quot;Unknown&amp;quot;;&amp;#xD;&amp;#xA;String ClientName=xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;vmClientname&amp;quot;]};&amp;#xD;&amp;#xA;String ClientHostName=xpath:{/workflow/variables/vmIPAddress};&amp;#xD;&amp;#xA;String CSName=xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;csName&amp;quot;]};&amp;#xD;&amp;#xA;String CSHostName=xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;csHostName&amp;quot;]};&amp;#xD;&amp;#xA;String CSUserName=xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;csUsername&amp;quot;]};&amp;#xD;&amp;#xA;String CSPassword= xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;csPassword&amp;quot;]};&amp;#xD;&amp;#xA;String authCode= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;authCode&amp;quot;]};&amp;#xD;&amp;#xA;String encryptCSPassword =  (utils.encryptString(CSPassword)).toString();&amp;#xD;&amp;#xA;Integer vsaProxyOSType = xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;osType&amp;quot;]}; //vsaproxy&amp;#xD;&amp;#xA;//String decodedString = commvault.cte.util.Base64.decode(xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;vmPassword&amp;quot;]});&amp;#xD;&amp;#xA;//String decrypted = utils.decryptString(decodedString);&amp;#xD;&amp;#xA;//workflow.setVariable(&amp;quot;vmPassword&amp;quot;,decrypted);&amp;#xD;&amp;#xA;String scriptPrefix = &amp;quot;C:\\Windows\\Temp\\RegistrationScript_&amp;quot;;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;//String XmlInput=&amp;quot;@echo Powershell.exe -executionpolicy remotesigned -File C:\\Windows\\Temp\\CVAutoDeployment\\baseInitScript.ps1&amp;quot;;&amp;#xD;&amp;#xA;String XmlInput=&amp;quot;@echo sudo pwsh /etc/baseInitScript.ps1&amp;quot;;&amp;#xD;&amp;#xA;if(vsaProxyOSType.equals(2)){&amp;#xD;&amp;#xA;scriptPrefix = &amp;quot;/tmp/RegistrationScript_&amp;quot;;&amp;#xD;&amp;#xA;XmlInput=&amp;quot;echo sudo pwsh /etc/baseInitScript.ps1&amp;quot;;&amp;#xD;&amp;#xA;}&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;String scriptPath=scriptPrefix+String.valueOf(xpath:{/workflow/system/jobId})+xpath:{/workflow/inputs/vmName}+&amp;quot;.sh&amp;quot;;&amp;#xD;&amp;#xA;String scriptlogPath=scriptPrefix+String.valueOf(xpath:{/workflow/system/jobId})+xpath:{/workflow/inputs/vmName}+&amp;quot;.log&amp;quot;;&amp;#xD;&amp;#xA;String XmlArguments = &amp;quot;&amp;quot;;&amp;#xD;&amp;#xA;XmlArguments+=osType;&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+ClientName;&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+ClientHostName;&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+CSName;&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+CSHostName;&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+CSUserName;&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+encryptCSPassword;&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+xpath:{/workflow/variables/enableFirewall};&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; NA&amp;quot;; //CSFirewallPort&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; NA&amp;quot;; //ClientFirewallPort&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+xpath:{/workflow/variables/gatewayHostname};&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+xpath:{/workflow/variables/gatewayClientName};&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+xpath:{/workflow/variables/gatewayPort};&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; NA&amp;quot;; //httphostname&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; NA&amp;quot;; //port&amp;#xD;&amp;#xA;if(authCode != null &amp;amp;&amp;amp; authCode.length() &amp;gt; 0){&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; &amp;quot;+authCode;&amp;#xD;&amp;#xA;}else{&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; NA&amp;quot;; //authCode&amp;#xD;&amp;#xA;}&amp;#xD;&amp;#xA;XmlArguments+=&amp;quot; NA&amp;quot;; //csplainpassword&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;XmlInput+=&amp;quot; &amp;quot;+XmlArguments;&amp;#xD;&amp;#xA;// turn off firewall on unix nodes if there is no FW configured else CS is not able to communicate&amp;#xD;&amp;#xA;if (osType.equalsIgnoreCase(&amp;quot;Unix&amp;quot;))&amp;#xD;&amp;#xA;{&amp;#xD;&amp;#xA;if(vsaProxyOSType.equals(2)){&amp;#xD;&amp;#xA;workflow.setVariable(&amp;quot;firewallStop&amp;quot;,&amp;quot;echo 'sudo systemctl stop firewalld;sudo systemctl disable firewalld'&amp;quot;);&amp;#xD;&amp;#xA;}else{&amp;#xD;&amp;#xA;workflow.setVariable(&amp;quot;firewallStop&amp;quot;,&amp;quot;@echo | set /p c=sudo systemctl stop firewalld;sudo systemctl disable firewalld&amp;quot;);&amp;#xD;&amp;#xA;}&amp;#xD;&amp;#xA;    &amp;#xD;&amp;#xA;    workflow.setVariable(&amp;quot;scriptPath_FW&amp;quot;,scriptPrefix+String.valueOf(xpath:{/workflow/system/jobId})+xpath:{/workflow/inputs/vmName}+&amp;quot;.fw.sh&amp;quot;);&amp;#xD;&amp;#xA;    workflow.setVariable(&amp;quot;scriptLogPath_FW&amp;quot;,scriptPrefix+String.valueOf(xpath:{/workflow/system/jobId})+xpath:{/workflow/inputs/vmName}+&amp;quot;.fw.log&amp;quot;);&amp;#xD;&amp;#xA;}&amp;#xD;&amp;#xA;workflow.setVariable(&amp;quot;scriptPath&amp;quot;,scriptPath);&amp;#xD;&amp;#xA;workflow.setVariable(&amp;quot;scriptlogPath&amp;quot;,scriptlogPath);&amp;#xD;&amp;#xA;workflow.setVariable(&amp;quot;XmlArguments&amp;quot;,XmlArguments);&amp;#xD;&amp;#xA;return XmlInput;&amp;#xD;&amp;#xA;&quot; />&lt;/inputs>"/>
        <transition activity="WorkflowEnd_1" commented="0"
            displayName="Failed&#xd;&#xa;" originalStyle="" points=""
            sourceX="614" sourceY="210" status="2" style="defaultEdge"
            targetX="971" targetY="415" transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
        <transition activity="HttpClient_10" commented="0"
            displayName="Success" originalStyle="" points=""
            sourceX="848" sourceY="253" status="0" style="defaultEdge"
            targetX="1105" targetY="73" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1585740632850"
        description="Execute a script on a remote machine"
        displayName="Prepare Installation" height="34" interactive="0"
        jobMode="0" maxRestarts="0" name="ExecuteScript"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ExecuteScript"
        uniqueName="ExecuteScript_1" waitSetting="0" width="141"
        x="1193" y="86">
        <onExit language="1" script="if(xpath:{/workflow/ExecuteScript_1/exitCode}!=0 || xpath:{/workflow/ExecuteScript_1/errorCode}!=0)&#xd;&#xa;   workflow.setVariable(&quot;failureMessage&quot;,&quot;Failed to create batch file&quot;);"/>
        <inputs val="&lt;inputs>&lt;client class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vsaProxy&quot;]}&lt;/client>&lt;impersonateUserName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;impersonateUserPassword class=&quot;workflow.types.EncryptedString&quot; _list_=&quot;false&quot; />&lt;startUpPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;scriptType class=&quot;commvault.msgs.App.ScriptType&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;scriptType&quot;]}&lt;/scriptType>&lt;script class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/Script_2/output} &amp;gt; xpath:{/workflow/variables/scriptPath}&lt;/script>&lt;arguments class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;waitForProcessCompletion class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/waitForProcessCompletion>&lt;/inputs>"/>
        <transition activity="ExecuteScriptInGuestOS_1" commented="0"
            displayName="Succeed" originalStyle="" points=""
            sourceX="774" sourceY="180" status="3" style="defaultEdge"
            targetX="961" targetY="175" transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScript_1/exitCode}==0 &amp;&amp; xpath:{/workflow/ExecuteScript_1/errorCode}==0;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1586175291856"
        description="This operation used to execute script on guest os in the provided VM"
        displayName="Dock" height="34" interactive="0" jobMode="0"
        maxRestarts="5" name="ExecuteScriptInGuestOS"
        namespaceUri="commvault.cte.workflow.activities.VMUtilities"
        originalStyle="" restartInterval="1" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.VMUtilities.ExecuteScriptInGuestOS"
        uniqueName="ExecuteScriptInGuestOS_1" waitSetting="0"
        width="170" x="1179" y="153">
        <onExit language="1" script="if(xpath:{/workflow/ExecuteScriptInGuestOS_1/errorCode}!=0 || xpath:{/workflow/ExecuteScriptInGuestOS_1/exitCode}!=0)&#xd;&#xa;   workflow.setVariable(&quot;failureMessage&quot;,&quot;Failed to run &quot;);"/>
        <inputs val="&lt;inputs>&lt;vmClientName class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientId class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot; />&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;hostName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;displayName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;commCellName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;csGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;type class=&quot;commvault.msgs.CvEntities.CommCellType&quot; _list_=&quot;false&quot; />&lt;flags class=&quot;commvault.msgs.CvEntities.EntityFlags&quot; _list_=&quot;false&quot; />&lt;GUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;newName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/vmClientName>&lt;vmName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmName&quot;]}&lt;/vmName>&lt;vmGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}&lt;/vmGUID>&lt;virtualizationClient class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;hypervisorName&quot;]}&lt;/virtualizationClient>&lt;isUNCPath class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>false&lt;/isUNCPath>&lt;scriptPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/scriptPath}&lt;/scriptPath>&lt;scriptLog class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/scriptlogPath}&lt;/scriptLog>&lt;uncPathUserName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;uncPathPassword class=&quot;workflow.types.EncryptedString&quot; _list_=&quot;false&quot; />&lt;guestOSUserName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmUsername&quot;]}&lt;/guestOSUserName>&lt;guestOSPassword class=&quot;workflow.types.EncryptedString&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/vmPassword}&lt;/guestOSPassword>&lt;vsaProxyClient class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vsaProxy&quot;]}&lt;/vsaProxyClient>&lt;timeOutInSeconds class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot;>480&lt;/timeOutInSeconds>&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="XPathQuery_26" commented="0"
            originalStyle="" points="" sourceX="1241" sourceY="199"
            status="0" style="defaultEdge" targetX="1242" targetY="265"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1395163955278"
        description="Sends an email to a list of users"
        displayName="Email" height="34" interactive="0" jobMode="0"
        maxRestarts="0" name="Email"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=Email"
        uniqueName="Email_2" waitSetting="0" width="100" x="1013" y="340">
        <inputs val="&lt;inputs>&lt;email class=&quot;workflow.types.Email&quot;>&lt;to class=&quot;java.lang.String&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;emailId&quot;]}&lt;/to>&lt;cc class=&quot;java.lang.String&quot; />&lt;bcc class=&quot;java.lang.String&quot; />&lt;from class=&quot;java.lang.String&quot; />&lt;subject class=&quot;java.lang.String&quot;>Auto-docking of VM  xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmName&quot;]} is failed&lt;/subject>&lt;body class=&quot;java.lang.String&quot;> &amp;#xD;&#xd;&#xa;Failed to register VM xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmName&quot;]}  to CommServe. &amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;&lt;/body>&lt;attachments class=&quot;java.lang.Object&quot; />&lt;html class=&quot;java.lang.Boolean&quot;>false&lt;/html>&lt;repeatInterval />&lt;/email>&lt;/inputs>"/>
        <transition activity="WorkflowEnd_1" commented="0"
            originalStyle="" points="" sourceX="970" sourceY="299"
            status="0" style="defaultEdge" targetX="971" targetY="359"
            transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1586246288964" description="Ends the workflow"
        displayName="Failed" height="34" interactive="0" jobMode="0"
        name="WorkflowEnd"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.EndActivity"
        uniqueName="WorkflowEnd_1" waitSetting="0" width="106" x="761" y="342">
        <inputs val="&lt;inputs>&lt;completionStatus class=&quot;workflow.types.WorkflowCompletionStatus&quot; _list_=&quot;false&quot;>FAILED&lt;/completionStatus>&lt;failureMessage class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/failureMessage}&lt;/failureMessage>&lt;/inputs>"/>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1586254063523"
        description="Sends an email to a list of users"
        displayName="Email" height="34" interactive="0" jobMode="0"
        maxRestarts="0" name="Email"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=Email"
        uniqueName="Email_3" waitSetting="0" width="100" x="1651" y="344">
        <inputs val="&lt;inputs>&lt;email class=&quot;workflow.types.Email&quot;>&lt;to class=&quot;java.lang.String&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;emailId&quot;]}&lt;/to>&lt;cc class=&quot;java.lang.String&quot; />&lt;bcc class=&quot;java.lang.String&quot; />&lt;from class=&quot;java.lang.String&quot; />&lt;subject class=&quot;java.lang.String&quot;>Auto-docking of VM  xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmName&quot;]} is succeed&lt;/subject>&lt;body class=&quot;java.lang.String&quot;> xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmName&quot;]} VM registration is successful. Client is ready to use. &lt;/body>&lt;attachments class=&quot;java.lang.Object&quot; />&lt;html class=&quot;java.lang.Boolean&quot;>false&lt;/html>&lt;repeatInterval />&lt;/email>&lt;/inputs>"/>
        <transition activity="WorkflowEnd_2" commented="0"
            originalStyle="" points="" sourceX="1437" sourceY="198"
            status="0" style="defaultEdge" targetX="1465" targetY="300"
            transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1586254238656" description="Ends the workflow"
        displayName="Complete" height="34" interactive="0" jobMode="0"
        name="WorkflowEnd"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.EndActivity"
        uniqueName="WorkflowEnd_2" waitSetting="0" width="106" x="1651" y="439">
        <outputs outputs="&lt;outputs>&lt;clientId class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmClientId&quot;]}&lt;/clientId>&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmClientname&quot;]}&lt;/clientName>&lt;/outputs>"/>
        <inputs val="&lt;inputs>&lt;completionStatus class=&quot;workflow.types.WorkflowCompletionStatus&quot; _list_=&quot;false&quot;>COMPLETED&lt;/completionStatus>&lt;failureMessage class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>&quot;VM registration sucessfull&quot;&lt;/failureMessage>&lt;/inputs>"/>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1586283381871"
        description="This operation used to refresh the VM details/discover the VM"
        displayName="Synchronize" height="34" interactive="0"
        jobMode="0" name="Synchronize"
        namespaceUri="commvault.cte.workflow.activities.VMUtilities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.VMUtilities.Synchronize"
        uniqueName="Synchronize_1" waitSetting="0" width="100" x="487" y="148">
        <inputs val="&lt;inputs>&lt;vmClientName class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientId class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot; />&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;hostName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;displayName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;commCellName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;csGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;type class=&quot;commvault.msgs.CvEntities.CommCellType&quot; _list_=&quot;false&quot; />&lt;flags class=&quot;commvault.msgs.CvEntities.EntityFlags&quot; _list_=&quot;false&quot; />&lt;GUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;newName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/vmClientName>&lt;vmName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmName&quot;]}&lt;/vmName>&lt;vmGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}&lt;/vmGUID>&lt;virtualizationClient class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;hypervisorName&quot;]}&lt;/virtualizationClient>&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="CommServDBQuery_2" commented="0"
            originalStyle="" points="" sourceX="580" sourceY="75"
            status="0" style="defaultEdge" targetX="756" targetY="76"
            transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1586283465035"
        description="executes queries against a commcell database"
        displayName="Collecting IP" height="34" interactive="0"
        jobMode="0" name="CommServDBQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.CommServDBQuery"
        uniqueName="CommServDBQuery_2" waitSetting="0" width="149"
        x="567" y="56">
        <onExit language="1" script="if(xpath:{/workflow/CommServDBQuery_2/resultSets/row/col[@name=&quot;vmIP&quot;]}!=null &amp;&amp; xpath:{/workflow/CommServDBQuery_2/resultSets/row/col[@name=&quot;vmIP&quot;]}.length() > 0){&#xd;&#xa;    workflow.setVariable(&quot;vmIPAddress&quot;,xpath:{/workflow/CommServDBQuery_2/resultSets/row/col[@name=&quot;vmIP&quot;]});&#xd;&#xa;    workflow.setVariable(&quot;vmSyncCount&quot;,0);&#xd;&#xa;}else{&#xd;&#xa;    int vmSyncCount = xpath:{/workflow/variables/vmSyncCount};&#xd;&#xa;    vmSyncCount = vmSyncCount-1;&#xd;&#xa;    workflow.setVariable(&quot;vmSyncCount&quot;,vmSyncCount);&#xd;&#xa;}&#xd;&#xa;   &#xd;&#xa; "/>
        <inputs val="&lt;inputs>&lt;commCell />&lt;query>set nocount on&amp;#xD;&#xd;&#xa;declare @vmGUID nvarchar(256) = 'xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}'&amp;#xD;&#xd;&#xa;declare @vmIP nvarchar(256)&amp;#xD;&#xd;&#xa;declare @vmClientId int&amp;#xD;&#xd;&#xa;select &amp;#xD;&#xd;&#xa;&#x9; @vmIP = vmIp.value('@ipAddress','nvarchar(1024)') ,&amp;#xD;&#xd;&#xa;&#x9; @vmClientId =  vm.clientId&amp;#xD;&#xd;&#xa;&#x9; from APP_VM vm inner join APP_VMHost vmh on vmh.id=vm.vHostId&amp;#xD;&#xd;&#xa;&#x9; inner join app_client cl on cl.id=vm.clientId&amp;#xD;&#xd;&#xa;&#x9; CROSS APPLY vm.vxml.nodes('/QSMServer_QVirtualMachineReq') as vmIp(vmIp) &amp;#xD;&#xd;&#xa;&#x9; where vm.GUID=@vmGUID &amp;#xD;&#xd;&#xa;IF LEN(@vmIP) &amp;gt; 15 --IPv4 max len is 15&amp;#xD;&#xd;&#xa;BEGIN    &amp;#xD;&#xd;&#xa;   SET @vmIP = ''&amp;#xD;&#xd;&#xa;END&amp;#xD;&#xd;&#xa;ELSE IF ISNULL(@vmIP,'') !='' AND LEN(@vmIP) &amp;gt; 0&amp;#xD;&#xd;&#xa;BEGIN&amp;#xD;&#xd;&#xa;    update app_client set net_hostname = @vmIP where id = @vmClientId&amp;#xD;&#xd;&#xa;END&amp;#xD;&#xd;&#xa;     &amp;#xD;&#xd;&#xa; select @vmIP as 'vmIP'&amp;#xD;&#xd;&#xa; &amp;#xD;&#xd;&#xa; set nocount off&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&amp;#xD;&#xd;&#xa;&#x9;&lt;/query>&lt;/inputs>"/>
        <transition activity="Script_2" commented="0" originalStyle=""
            points="" sourceX="649" sourceY="47" status="0"
            style="defaultEdge" targetX="789" targetY="79"
            transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/variables/vmSyncCount}==0;"/>
        </transition>
        <transition activity="Delay_1" commented="0" originalStyle=""
            points="657.8947368421053,173.6842105263158" sourceX="641"
            sourceY="73" status="0" style="defaultEdge" targetX="547"
            targetY="256" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/variables/vmSyncCount}>0;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1586284477374"
        description="activity to delay the workflow execution in minutes"
        displayName="Delay" height="34" interactive="0" jobMode="0"
        name="Delay" namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.DelayActivity"
        uniqueName="Delay_1" waitSetting="0" width="100" x="474" y="237">
        <inputs val="&lt;inputs>&lt;delayLength class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot;>1&lt;/delayLength>&lt;delayInterval class=&quot;workflow.types.DelayInterval&quot; _list_=&quot;false&quot;>Minutes&lt;/delayInterval>&lt;/inputs>"/>
        <transition activity="Synchronize_1" commented="0"
            originalStyle="" points="" sourceX="536" sourceY="132"
            status="0" style="defaultEdge" targetX="553" targetY="84"
            transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1587808211321"
        description="executes queries against a commcell database"
        displayName="Prepare VM Creation" height="34" interactive="0"
        jobMode="0" name="CommServDBQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.CommServDBQuery"
        uniqueName="CommServDBQuery_3" waitSetting="0" width="149"
        x="70" y="71">
        <onExit language="1" script="if(xpath:{/workflow/CommServDBQuery_3/resultSets/row[1]/col[@name=&quot;errorCode&quot;]}!=0){&#xd;&#xa;  if(xpath:{/workflow/CommServDBQuery_3/resultSets/row[1]/col[@name=&quot;errorMessage&quot;]}!=null &amp;&amp; xpath:{/workflow/CommServDBQuery_3/resultSets/row[1]/col[@name=&quot;errorMessage&quot;]}.length() > 0){&#xd;&#xa;     workflow.setVariable(&quot;failureMessage&quot;,xpath:{/workflow/CommServDBQuery_3/resultSets/row[1]/col[@name=&quot;errorMessage&quot;]});&#xd;&#xa;  }else{&#xd;&#xa;   workflow.setVariable(&quot;failureMessage&quot;,&quot;Failed to submit VM creation, please check log for more details&quot;);&#xd;&#xa;  }&#xd;&#xa;}"/>
        <inputs val="&lt;inputs>&lt;commCell />&lt;query>set nocount on&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;--input&amp;#xD;&#xd;&#xa;declare @errorMessage nvarchar(1024)&amp;#xD;&#xd;&#xa;declare @errorCode int =0&amp;#xD;&#xd;&#xa;declare @hypevisorName nvarchar(max)= isnull('xpath:{/workflow/inputs/hypervisorName}','')&amp;#xD;&#xd;&#xa;declare @dataCenterName nvarchar(max)= isnull('xpath:{/workflow/inputs/dataCenterName}','xpath:{/workflow/variables/dataCenterName}')&amp;#xD;&#xd;&#xa;declare @resoucePool nvarchar(max)= isnull('xpath:{/workflow/inputs/resourcePool}','xpath:{/workflow/variables/resourcePool}')&amp;#xD;&#xd;&#xa;declare @hostName nvarchar(1024) = isnull('xpath:{/workflow/inputs/vmHost}','xpath:{/workflow/variables/vmHost}')&amp;#xD;&#xd;&#xa;declare @networkName nvarchar(1024) = isnull('xpath:{/workflow/inputs/vmNetwork}','xpath:{/workflow/variables/vmNetwork}')&amp;#xD;&#xd;&#xa;declare @dataStore nvarchar(1024) = isnull('xpath:{/workflow/inputs/dataStore}','xpath:{/workflow/variables/dataStore}')&amp;#xD;&#xd;&#xa;declare @vmName nvarchar(1024) = isnull('xpath:{/workflow/inputs/vmName}','AutoDemo')&amp;#xD;&#xd;&#xa;declare @emailId nvarchar(1024)= (select email from umusers where id =xpath:{/workflow/system/executor/userId})&amp;#xD;&#xd;&#xa;declare @companyId  int = isnull((select top 1 id from UMDSProviders where hostName='xpath:{/workflow/inputs/companyName}') , 0)&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;IF @dataCenterName = ''&amp;#xD;&#xd;&#xa;    SET @dataCenterName = 'xpath:{/workflow/variables/dataCenterName}'&amp;#xD;&#xd;&#xa;IF @resoucePool = ''&amp;#xD;&#xd;&#xa;    SET @resoucePool = 'xpath:{/workflow/variables/resourcePool}'&amp;#xD;&#xd;&#xa;IF @hostName = ''&amp;#xD;&#xd;&#xa;    SET @hostName = 'xpath:{/workflow/variables/vmHost}'&amp;#xD;&#xd;&#xa;IF @networkName = ''&amp;#xD;&#xd;&#xa;    SET @networkName = 'xpath:{/workflow/variables/vmNetwork}'&amp;#xD;&#xd;&#xa;IF @dataStore = ''&amp;#xD;&#xd;&#xa;    SET @dataStore = 'xpath:{/workflow/variables/dataStore}'                                     &amp;#xD;&#xd;&#xa;--output&amp;#xD;&#xd;&#xa;declare @username nvarchar(max)&amp;#xD;&#xd;&#xa;declare @password nvarchar(max)&amp;#xD;&#xd;&#xa;declare @vcentername nvarchar(max)&amp;#xD;&#xd;&#xa;declare @vsaproxyClient nvarchar(max)&amp;#xD;&#xd;&#xa;declare @vsaproxyClientId int&amp;#xD;&#xd;&#xa;declare @osType int&amp;#xD;&#xd;&#xa;declare @hypervisorClientId int&amp;#xD;&#xd;&#xa;declare @authCode nvarchar(max)&amp;#xD;&#xd;&#xa;declare @ovfToolPath nvarchar(max)&amp;#xD;&#xd;&#xa;declare @scripType nvarchar(max)&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa; --intermediate&amp;#xD;&#xd;&#xa; declare @instanceId int &amp;#xD;&#xd;&#xa; &amp;#xD;&#xd;&#xa;if isnull(@hypevisorName,'') = ''&amp;#xD;&#xd;&#xa;begin&amp;#xD;&#xd;&#xa;&#x9;set @errorCode = -1&amp;#xD;&#xd;&#xa;&#x9;set @errorMessage = 'Provide valid vcenter/hypervisor name'&amp;#xD;&#xd;&#xa;&#x9;goto ERROR_EXIT&amp;#xD;&#xd;&#xa;end&amp;#xD;&#xd;&#xa;select @instanceId =app.instance, @hypervisorClientId = c.id from app_client c inner join app_application app on app.clientId=c.id and apptypeid=106 where c.name =@hypevisorName&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;--if client name doens't match get from the vcentername&amp;#xD;&#xd;&#xa;if isnull(@instanceId,0) = 0&amp;#xD;&#xd;&#xa;select @instanceId = componentnameId from app_instanceprop where attrval = @hypevisorName and attrname='Virtual Server Host'&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;if isnull(@instanceId,0) = 0&amp;#xD;&#xd;&#xa;begin&amp;#xD;&#xd;&#xa;&#x9;set @errorCode = -1&amp;#xD;&#xd;&#xa;&#x9;set @errorMessage = 'Provide valid vcenter/hypervisor name'&amp;#xD;&#xd;&#xa;&#x9;goto ERROR_EXIT&amp;#xD;&#xd;&#xa;end&amp;#xD;&#xd;&#xa;select @vcentername = attrval from app_instanceprop where componentnameId = @instanceId and attrname='Virtual Server Host'&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;select @username = attrval from app_instanceprop where componentnameId = @instanceId and attrname='Virtual Server User'&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;select @password = attrval from app_instanceprop where componentnameId = @instanceId and attrname='Virtual Server Password'&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;select @authCode = cast(cpp.attrVal as nvarchar(max)) from  App_CompanyProp cpp&#x9;&amp;#xD;&#xd;&#xa;&#x9;&#x9;where&amp;#xD;&#xd;&#xa;&#x9;&#x9; cpp.componentNameId = @companyId&amp;#xD;&#xd;&#xa;&#x9;&#x9;and cpp.attrName = 'Authorization Code'&amp;#xD;&#xd;&#xa;&#x9;&#x9;and cpp.modified = 0&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;CREATE TABLE #tmpTable&amp;#xD;&#xd;&#xa;&#x9;(&amp;#xD;&#xd;&#xa;&#x9;&#x9;OutputValue XML&amp;#xD;&#xd;&#xa;&#x9;)&amp;#xD;&#xd;&#xa;&#x9;declare @inputxml xml&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;&#x9;declare @output xml&amp;#xD;&#xd;&#xa;    SET @inputxml = '&amp;lt;App_GetVSMemberServersRequest expandClientGroup=&quot;1&quot;&amp;gt;&amp;lt;entity _type_=&quot;5&quot; instanceId=&quot;' + convert(varchar(10),@instanceId) + '&quot;/&amp;gt;&amp;lt;/App_GetVSMemberServersRequest&amp;gt;'&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;    INSERT INTO #tmpTable(OutputValue) &amp;#xD;&#xd;&#xa;    EXEC AppGetVSMemberServers @inputxml&amp;#xD;&#xd;&#xa;    &amp;#xD;&#xd;&#xa;    SELECT @output = OutputValue FROM #tmpTable&amp;#xD;&#xd;&#xa;    DROP TABLE #tmpTable&amp;#xD;&#xd;&#xa;    select @vsaproxyClient = g.x.value('@clientName','nvarchar(max)') , @vsaproxyClientId =  g.x.value('@clientId','nvarchar(max)') from @output.nodes('/App_GetVSMemberServersResponse/associatedClients/memberServers[1]/client[1]') g(x)&amp;#xD;&#xd;&#xa;    SET @osType = isnull((select 1  from simInstalledPackages where clientId=@vsaproxyClientId and simPackageId = 713),2)&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;&#x9;IF @osType = 1 --Windows&amp;#xD;&#xd;&#xa;&#x9;BEGIN&amp;#xD;&#xd;&#xa;&#x9;&#x9;SET  @scripType&#x9;&#x9;= 'WindowsBatch'&amp;#xD;&#xd;&#xa;&#x9;&#x9;SET  @ovfToolPath&#x9;= 'xpath:{/workflow/variables/ovftoolpath}'&amp;#xD;&#xd;&#xa;&#x9;END&amp;#xD;&#xd;&#xa;&#x9;ELSE&amp;#xD;&#xd;&#xa;&#x9;BEGIN&amp;#xD;&#xd;&#xa;&#x9;&#x9;SET  @scripType = 'UnixShell'&amp;#xD;&#xd;&#xa;&#x9;&#x9;SET  @ovfToolPath&#x9;= 'xpath:{/workflow/variables/unixOvfPath}'&amp;#xD;&#xd;&#xa;&#x9;END&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;ERROR_EXIT:&amp;#xD;&#xd;&#xa;select @errorCode 'errorCode' , @errorMessage 'errorMessage', @hostName 'hostName', @networkName 'networkName',&amp;#xD;&#xd;&#xa;  @vmName 'vmName', @instanceId 'instanceId', @vcentername 'vcentername', @username 'username',&amp;#xD;&#xd;&#xa;  @password 'password', @hypevisorName 'hypervisorName', @hypervisorClientId 'hypervisorClientId' , &amp;#xD;&#xd;&#xa;  @vsaProxyClient 'vsaProxy', @vsaproxyClientId 'vsaproxyClientId', @dataCenterName 'dataCenterName' , &amp;#xD;&#xd;&#xa;  @dataStore 'dataStore', @resoucePool 'resourcePool', @authCode 'authCode', @companyId 'companyId',&amp;#xD;&#xd;&#xa;  @scripType 'scriptType',  @ovfToolPath 'ovfToolPath', @osType 'osType'&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;set nocount off&amp;#xD;&#xd;&#xa;&#x9;&lt;/query>&lt;/inputs>"/>
        <transition activity="Email_4" commented="0" displayName="Error"
            originalStyle="" points="" sourceX="165" sourceY="89"
            status="0" style="defaultEdge" targetX="331" targetY="177"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/CommServDBQuery_3/resultSets/row[1]/col[@name=&quot;errorCode&quot;]}!=0;"/>
        </transition>
        <transition activity="Execute_2" commented="0" originalStyle=""
            points="" sourceX="167" sourceY="106" status="0"
            style="defaultEdge" targetX="167" targetY="149"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/CommServDBQuery_3/resultSets/row[1]/col[@name=&quot;errorCode&quot;]}==0;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1587815438108"
        description="Sends an email to a list of users"
        displayName="Email" height="34" interactive="0" jobMode="0"
        maxRestarts="0" name="Email"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=Email"
        uniqueName="Email_4" waitSetting="0" width="100" x="316" y="94">
        <inputs val="&lt;inputs>&lt;email class=&quot;workflow.types.Email&quot;>&lt;to class=&quot;java.lang.String&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;emailId&quot;]}&lt;/to>&lt;cc class=&quot;java.lang.String&quot; />&lt;bcc class=&quot;java.lang.String&quot; />&lt;from class=&quot;java.lang.String&quot; />&lt;subject class=&quot;java.lang.String&quot;>VM [xpath:{/workflow/inputs/vmName}] creation is failed&lt;/subject>&lt;body class=&quot;java.lang.String&quot;> &amp;#xD;&#xd;&#xa;VM creation failed with error : xpath:{/workflow/variables/failureMessage}&amp;#xD;&#xd;&#xa;&lt;/body>&lt;attachments class=&quot;java.lang.Object&quot; />&lt;html class=&quot;java.lang.Boolean&quot;>false&lt;/html>&lt;repeatInterval />&lt;/email>&lt;/inputs>"/>
        <transition activity="WorkflowEnd_3" commented="0"
            originalStyle="" points="" sourceX="331" sourceY="177"
            status="0" style="defaultEdge" targetX="329" targetY="269"
            transitionIndex="0" x="0" y="0">
            <condition script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1587815453959" description="Ends the workflow"
        displayName="Failed" height="34" interactive="0" jobMode="0"
        name="WorkflowEnd"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.EndActivity"
        uniqueName="WorkflowEnd_3" waitSetting="0" width="106" x="326" y="203">
        <inputs val="&lt;inputs>&lt;completionStatus class=&quot;workflow.types.WorkflowCompletionStatus&quot; _list_=&quot;false&quot;>FAILED&lt;/completionStatus>&lt;failureMessage class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/failureMessage}&lt;/failureMessage>&lt;/inputs>"/>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1587878485443"
        description="activity to execute code snippets in the selected language"
        displayName="Prepare OVA Download" height="34" interactive="0"
        jobMode="0" name="Script"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ScriptActivity"
        uniqueName="Script_3" waitSetting="0" width="163" x="71" y="190">
        <inputs val="&lt;inputs>&lt;script language=&quot;1&quot; script=&quot;&amp;#xD;&amp;#xA;String vCenterName = xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;vcentername&amp;quot;]};&amp;#xD;&amp;#xA;String vCenterUserName= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;username&amp;quot;]};&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;String vCenterPassword = utils.decryptString(xpath:{/workflow/CommServDBQuery_5/resultSets/row/col});&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;String vmName= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;vmName&amp;quot;]};&amp;#xD;&amp;#xA;String dataStore= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;dataStore&amp;quot;]};&amp;#xD;&amp;#xA;String hostName= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;hostName&amp;quot;]};&amp;#xD;&amp;#xA;String dataCenterName= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;dataCenterName&amp;quot;]};&amp;#xD;&amp;#xA;String resourcePool= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;resourcePool&amp;quot;]};&amp;#xD;&amp;#xA;String networkName= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;networkName&amp;quot;]};&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;String ovaPath= xpath:{/workflow/inputs/ovaPath};&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;if(ovaPath == null || ovaPath.length() == 0){&amp;#xD;&amp;#xA; if(xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;osType&amp;quot;]}!=null &amp;amp;&amp;amp; xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;osType&amp;quot;]} ==1){&amp;#xD;&amp;#xA; ovaPath = xpath:{/workflow/variables/ovaPath};&amp;#xD;&amp;#xA; }else{&amp;#xD;&amp;#xA; ovaPath = xpath:{/workflow/variables/ovaUnixPath};&amp;#xD;&amp;#xA; }&amp;#xD;&amp;#xA;}&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;//ovftool --acceptAllEulas --noSSLVerify --acceptAllEulas --diskMode=thin --powerOn  --name=&amp;quot;autodemo1&amp;quot; --datastore=&amp;quot;ESX02-DS02&amp;quot;  &amp;quot;F:\Projects\RAX\OVA\commvaultvsa.ova&amp;quot; &amp;quot;vi://username:Password@blrvsavc1.idcprodcert.loc/BLRVA/host/bdcvsaesx02.idcprodcert.loc/Resources/Compute-ResourcePool/&amp;quot;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;String ovfpath = &amp;quot;\&amp;quot;&amp;quot;+xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;ovfToolPath&amp;quot;]}+&amp;quot;\&amp;quot;&amp;quot;;&amp;#xD;&amp;#xA;String command = ovfpath + &amp;quot; --acceptAllEulas --noSSLVerify --acceptAllEulas --diskMode=thin --powerOn --X:waitForIp --name=\&amp;quot;&amp;quot;+vmName+&amp;quot;\&amp;quot; --network=\&amp;quot;&amp;quot;+networkName+&amp;quot;\&amp;quot;&amp;quot;;&amp;#xD;&amp;#xA;command +=&amp;quot; --datastore=\&amp;quot;&amp;quot;+dataStore+&amp;quot;\&amp;quot; \&amp;quot;&amp;quot;+ovaPath+&amp;quot;\&amp;quot; \&amp;quot;vi://&amp;quot;+vCenterUserName+&amp;quot;:&amp;quot;+vCenterPassword+&amp;quot;@&amp;quot;+vCenterName+&amp;quot;/&amp;quot;+dataCenterName+&amp;quot;/host/&amp;quot;+hostName+&amp;quot;/Resources/&amp;quot;+resourcePool+&amp;quot;/\&amp;quot;&amp;quot;;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;logger.info(&amp;quot;command&amp;quot;+command);&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;return command;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;//workflow.setVariable(&amp;quot;vmPassword&amp;quot;,decodedString);&quot; />&lt;/inputs>"/>
        <transition activity="ExecuteProcessBlock_1" commented="0"
            originalStyle="" points="" sourceX="152" sourceY="207"
            status="0" style="defaultEdge" targetX="126" targetY="258"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;(xpath:{/workflow/inputs/contentLibrary}!=null &amp;&amp; !xpath:{/workflow/inputs/contentLibrary}.isEmpty());"/>
        </transition>
        <transition activity="ExecuteScript_3" commented="0"
            originalStyle="" points="" sourceX="152" sourceY="207"
            status="0" style="defaultEdge" targetX="226" targetY="270"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;(xpath:{/workflow/inputs/contentLibrary}==null || xpath:{/workflow/inputs/contentLibrary}.isEmpty());"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1587912570653"
        description="retrieves a list of values from xml"
        displayName="Get ErrorMessage" height="34" interactive="0"
        jobMode="0" name="XPathQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=XPathQuery"
        uniqueName="XPathQuery_25" waitSetting="0" width="133" x="1255" y="276">
        <onExit language="1" script="if(xpath:{/workflow/XPathQuery_26/result}!=0){&#xd;&#xa;    if(xpath:{/workflow/XPathQuery_25/result}!=null &amp;&amp; xpath:{/workflow/XPathQuery_25/result}.length() > 0){&#xd;&#xa;       workflow.setVariable(&quot;failureMessage&quot;,xpath:{/workflow/XPathQuery_25/result});&#xd;&#xa;    }else{&#xd;&#xa;       workflow.setVariable(&quot;failureMessage&quot;,&quot;Failed to register client to commserve at guest os&quot;);&#xd;&#xa;    }&#xd;&#xa;}&#xd;&#xa;"/>
        <inputs val="&lt;inputs>&lt;xml class=&quot;java.lang.String&quot;>xpath:{/workflow/ExecuteScriptInGuestOS_1/commandOutput}&lt;/xml>&lt;xpath class=&quot;java.lang.String&quot;>/TMMsg_GenericResp/errorMessage&lt;/xpath>&lt;outputType class=&quot;workflow.types.SimpleType&quot;>String&lt;/outputType>&lt;outputAsList class=&quot;java.lang.Boolean&quot;>false&lt;/outputAsList>&lt;/inputs>"/>
        <transition activity="ExecuteScript_6" commented="0"
            displayName="Success &amp; Unix" originalStyle="" points=""
            sourceX="1274" sourceY="351" status="0" style="defaultEdge"
            targetX="1491" targetY="133" transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScriptInGuestOS_1/exitCode}==0 &amp;&amp; xpath:{/workflow/XPathQuery_26/result}==0 &amp;&amp; xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;osType&quot;]}==2 &amp;&amp; xpath:{/workflow/variables/enableFirewall}.equals(&quot;False&quot;);&#xa;"/>
        </transition>
        <transition activity="Email_3" commented="0"
            displayName="Success &amp; Wndows" originalStyle=""
            points="" sourceX="1248" sourceY="356" status="0"
            style="defaultEdge" targetX="1430" targetY="194"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScriptInGuestOS_1/exitCode}==0 &amp;&amp; xpath:{/workflow/XPathQuery_26/result}==0 &amp;&amp; xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;osType&quot;]}!=2;"/>
        </transition>
        <transition activity="Email_2" commented="0"
            displayName="Failed " originalStyle="" points=""
            sourceX="934" sourceY="68" status="0" style="defaultEdge"
            targetX="1018" targetY="204" transitionIndex="0" x="430" y="29">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScriptInGuestOS_1/exitCode}!=0 || xpath:{/workflow/XPathQuery_26/result}!=0;"/>
        </transition>
        <transition activity="CommServDBQuery_6" commented="0"
            displayName="Success &amp; Firewall Enabled"
            originalStyle="" points="" sourceX="1330" sourceY="308"
            status="0" style="defaultEdge" targetX="1318" targetY="400"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScriptInGuestOS_1/exitCode}==0 &amp;&amp; xpath:{/workflow/XPathQuery_26/result}==0 &amp;&amp; xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;osType&quot;]}==2 &amp;&amp; !xpath:{/workflow/variables/enableFirewall}.equals(&quot;False&quot;);&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1587913303089"
        description="retrieves a list of values from xml"
        displayName="Get ErrorCode" height="34" interactive="0"
        jobMode="0" name="XPathQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=XPathQuery"
        uniqueName="XPathQuery_26" waitSetting="0" width="133" x="1201" y="219">
        <inputs val="&lt;inputs>&lt;xml class=&quot;java.lang.String&quot;>xpath:{/workflow/ExecuteScriptInGuestOS_1/commandOutput}&lt;/xml>&lt;xpath class=&quot;java.lang.String&quot;>/TMMsg_GenericResp/errorCode&lt;/xpath>&lt;outputType class=&quot;workflow.types.SimpleType&quot;>Integer&lt;/outputType>&lt;outputAsList class=&quot;java.lang.Boolean&quot;>false&lt;/outputAsList>&lt;/inputs>"/>
        <transition activity="XPathQuery_25" commented="0"
            originalStyle="" points="" sourceX="1241" sourceY="276"
            status="0" style="defaultEdge" targetX="1247" targetY="362"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1589966327472"
        description="Execute a script on a remote machine"
        displayName="Upload OVA" height="34" interactive="0" jobMode="0"
        name="ExecuteScript"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ExecuteScript"
        uniqueName="ExecuteScript_3" waitSetting="0" width="110" x="178" y="283">
        <onExit language="1" script="if(xpath:{/workflow/ExecuteScript_3/exitCode}!=0  || xpath:{/workflow/ExecuteScript_3/errorCode}!=0){&#xd;&#xa;  if(xpath:{/workflow/ExecuteScript_3/commandOutput}!=null &amp;&amp; xpath:{/workflow/ExecuteScript_3/commandOutput}.length() > 0){&#xd;&#xa;     workflow.setVariable(&quot;failureMessage&quot;,xpath:{/workflow/ExecuteScript_3/commandOutput});&#xd;&#xa;  }else{&#xd;&#xa;   workflow.setVariable(&quot;failureMessage&quot;,&quot;Failed to submit VM creation, please check log for more details&quot;);&#xd;&#xa;  }&#xd;&#xa;}"/>
        <inputs val="&lt;inputs>&lt;client class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vsaProxy&quot;]}&lt;/client>&lt;impersonateUserName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;impersonateUserPassword class=&quot;workflow.types.EncryptedString&quot; _list_=&quot;false&quot; />&lt;startUpPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;scriptType class=&quot;commvault.msgs.App.ScriptType&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;scriptType&quot;]}&lt;/scriptType>&lt;script class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/Script_3/output}&lt;/script>&lt;arguments class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;waitForProcessCompletion class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/waitForProcessCompletion>&lt;/inputs>"/>
        <transition activity="WorkflowEnd_3" commented="0"
            originalStyle="" points="" sourceX="167" sourceY="250"
            status="0" style="defaultEdge" targetX="333" targetY="235"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScript_3/exitCode}!=0  || xpath:{/workflow/ExecuteScript_3/errorCode}!=0;"/>
        </transition>
        <transition activity="Script_4" commented="0" originalStyle=""
            points="" sourceX="236" sourceY="266" status="0"
            style="defaultEdge" targetX="191" targetY="317"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1589975859302"
        description="activity to execute code snippets in the selected language"
        displayName="Prepare Preview Req" height="34" interactive="0"
        jobMode="0" name="Script"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ScriptActivity"
        uniqueName="Script_4" waitSetting="0" width="150" x="84" y="342">
        <inputs val="&lt;inputs>&lt;script language=&quot;1&quot; script=&quot;String vmName= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;vmName&amp;quot;]};&amp;#xD;&amp;#xA;int hypervisorClientId= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;hypervisorClientId&amp;quot;]};&amp;#xD;&amp;#xA;String hypervisorName= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;hypervisorName&amp;quot;]};&amp;#xD;&amp;#xA;int instanceId= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;instanceId&amp;quot;]};&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;String previewInv= &amp;quot;&amp;lt;?xml version=\&amp;quot;1.0\&amp;quot; encoding=\&amp;quot;UTF-8\&amp;quot; standalone=\&amp;quot;no\&amp;quot; ?&amp;gt;&amp;lt;EVGui_PreviewInventoryReq createClientsForDiscoveredVms=\&amp;quot;0\&amp;quot; previewInventoryRespType=\&amp;quot;0\&amp;quot;&amp;gt;&amp;quot;&amp;#xD;&amp;#xA;        + &amp;quot;&amp;lt;appId applicationName=\&amp;quot;Virtual Server\&amp;quot; apptypeId=\&amp;quot;106\&amp;quot;  clientId=\&amp;quot;&amp;quot;+hypervisorClientId+&amp;quot;\&amp;quot; clientName=\&amp;quot;&amp;quot;+hypervisorName+&amp;quot;\&amp;quot; instanceId=\&amp;quot;&amp;quot;+instanceId+&amp;quot;\&amp;quot; instanceName=\&amp;quot;VMware\&amp;quot;/&amp;gt;&amp;quot;&amp;#xD;&amp;#xA;        + &amp;quot;&amp;lt;contentEntity allOrAnyChildren=\&amp;quot;0\&amp;quot;&amp;gt;&amp;quot;&amp;#xD;&amp;#xA;        + &amp;quot;&amp;lt;children allOrAnyChildren=\&amp;quot;1\&amp;quot; displayName=\&amp;quot;&amp;quot;+vmName+&amp;quot;\&amp;quot; equalsOrNotEquals=\&amp;quot;1\&amp;quot; name=\&amp;quot;\&amp;quot; path=\&amp;quot;\&amp;quot; type=\&amp;quot;10\&amp;quot;/&amp;gt;&amp;quot;&amp;#xD;&amp;#xA;        + &amp;quot;&amp;lt;/contentEntity&amp;gt;&amp;lt;filterEntity allOrAnyChildren=\&amp;quot;0\&amp;quot;/&amp;gt;&amp;lt;/EVGui_PreviewInventoryReq&amp;gt;&amp;quot;;&amp;#xD;&amp;#xA;return previewInv;&quot; />&lt;/inputs>"/>
        <transition activity="Execute_1" commented="0" originalStyle=""
            points="" sourceX="164" sourceY="325" status="0"
            style="defaultEdge" targetX="163" targetY="389"
            transitionIndex="0" x="0" y="0">
            <condition script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1589976179353" description="" displayName="Preview VM"
        height="34" interactive="0" jobMode="0" name="Execute"
        namespaceUri="commvault.cte.workflow.activities.cmd.operation"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.cmd.operation.OperationExecute"
        uniqueName="Execute_1" waitSetting="0" width="100" x="106" y="402">
        <inputs val="&lt;inputs>&lt;inputXml class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/Script_4/output}&lt;/inputXml>&lt;escapeXml class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>false&lt;/escapeXml>&lt;commandArgs class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="Script_5" commented="0" originalStyle=""
            points="" sourceX="156" sourceY="419" status="0"
            style="defaultEdge" targetX="153" targetY="471"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1589976296696"
        description="retrieves a list of values from xml"
        displayName="Get VM GUID" height="34" interactive="0"
        jobMode="0" name="XPathQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.XMLQueryActivity"
        uniqueName="XPathQuery_27" waitSetting="0" width="100" x="316" y="324">
        <onExit language="1" script="  if(xpath:{/workflow/XPathQuery_27/result}==null &amp;&amp; xpath:{/workflow/XPathQuery_27/result}.length() == 0){&#xd;&#xa;     workflow.setVariable(&quot;failureMessage&quot;,&quot;Failed to find the deployed VM&quot;);&#xd;&#xa;  }&#xd;&#xa;"/>
        <inputs val="&lt;inputs>&lt;xml class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/Execute_1/commandOutput}&lt;/xml>&lt;xpath class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>/EVGui_VirtualGuestHostList/scList/guid&lt;/xpath>&lt;outputType class=&quot;workflow.types.SimpleType&quot; _list_=&quot;false&quot;>String&lt;/outputType>&lt;outputAsList class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>false&lt;/outputAsList>&lt;/inputs>"/>
        <transition activity="WorkflowEnd_3" commented="0"
            displayName="Failed" originalStyle="" points=""
            sourceX="313" sourceY="388" status="0" style="defaultEdge"
            targetX="354" targetY="241" transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/XPathQuery_27/result}==null &amp;&amp; xpath:{/workflow/XPathQuery_27/result}.length() == 0;"/>
        </transition>
        <transition activity="Synchronize_2" commented="0"
            originalStyle="" points="" sourceX="366" sourceY="307"
            status="0" style="defaultEdge" targetX="368" targetY="398"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/XPathQuery_27/result}!=null &amp;&amp; xpath:{/workflow/XPathQuery_27/result}.length() > 0;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1589976820664"
        description="This operation used to refresh the VM details/discover the VM"
        displayName="Synchronize" height="34" interactive="0"
        jobMode="0" maxRestarts="5" name="Synchronize"
        namespaceUri="commvault.cte.workflow.activities.VMUtilities"
        originalStyle="" restartInterval="1" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.VMUtilities.Synchronize"
        uniqueName="Synchronize_2" waitSetting="0" width="100" x="318" y="381">
        <inputs val="&lt;inputs>&lt;vmClientName class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientId class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot; />&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;hostName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;displayName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;commCellName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;csGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;type class=&quot;commvault.msgs.CvEntities.CommCellType&quot; _list_=&quot;false&quot; />&lt;flags class=&quot;commvault.msgs.CvEntities.EntityFlags&quot; _list_=&quot;false&quot; />&lt;GUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;newName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/vmClientName>&lt;vmName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vmName&quot;]}&lt;/vmName>&lt;vmGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/XPathQuery_27/result}&lt;/vmGUID>&lt;virtualizationClient class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;hypervisorName&quot;]}&lt;/virtualizationClient>&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="PowerOn_1" commented="0" originalStyle=""
            points="" sourceX="368" sourceY="398" status="0"
            style="defaultEdge" targetX="366" targetY="461"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;(xpath:{/workflow/inputs/contentLibrary}!=null &amp;&amp; !xpath:{/workflow/inputs/contentLibrary}.isEmpty());"/>
        </transition>
        <transition activity="CommServDBQuery_4" commented="0"
            originalStyle="" points="" sourceX="368" sourceY="398"
            status="0" style="defaultEdge" targetX="481" targetY="412"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;(xpath:{/workflow/inputs/contentLibrary}==null || xpath:{/workflow/inputs/contentLibrary}.isEmpty());"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1590140924290" description=""
        displayName="Assign VM To  CG" height="34" interactive="0"
        jobMode="0" maxRestarts="0" name="ClientGroup"
        namespaceUri="commvault.cte.workflow.activities.cmd.modify"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.cmd.modify.ModifyClientGroup"
        uniqueName="ClientGroup_1" waitSetting="0" width="129" x="790" y="52">
        <inputs val="&lt;inputs>&lt;operation class=&quot;workflow.types.cmd.AddDelete&quot; _list_=&quot;false&quot;>add&lt;/operation>&lt;client class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmClientname&quot;]}&lt;/client>&lt;clientGroup class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/proxiesClientGroup}&lt;/clientGroup>&lt;argumentFilepath class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="HttpClient_10" commented="0"
            originalStyle="" points="" sourceX="813" sourceY="75"
            status="0" style="defaultEdge" targetX="1124" targetY="86"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1590259275847" description=""
        displayName="Set Firewall" height="34" interactive="0"
        jobMode="0" name="ExecuteScript"
        namespaceUri="commvault.cte.workflow.activities.cmd.operation"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.cmd.operation.OperationExecScript"
        uniqueName="ExecuteScript_4" waitSetting="0" width="110" x="798" y="139">
        <inputs val="&lt;inputs>&lt;scriptName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>QS_SetFirewallConfigOnClient.sql &lt;/scriptName>&lt;arguments class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>-si c=xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmClientname&quot;]}&lt;/arguments>&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="ClientGroup_1" commented="0"
            originalStyle="" points="" sourceX="815" sourceY="157"
            status="0" style="defaultEdge" targetX="812" targetY="85"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1590388593835" description="" displayName="Refresh DC"
        height="34" interactive="0" jobMode="0" name="Execute"
        namespaceUri="commvault.cte.workflow.activities.cmd.operation"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.cmd.operation.OperationExecute"
        uniqueName="Execute_2" waitSetting="0" width="100" x="15" y="131">
        <inputs val="&lt;inputs>&lt;inputXml class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&amp;gt;&amp;lt;EVGui_RefreshTemplateInformationReq clientId=&quot;0&quot; flags=&quot;1&quot; instanceId=&quot;xpath:{/workflow/CommServDBQuery_3/resultSets/row[1]/col[@name=&quot;instanceId&quot;]}&quot;/&amp;gt;&lt;/inputXml>&lt;escapeXml class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>false&lt;/escapeXml>&lt;commandArgs class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="CommServDBQuery_5" commented="0"
            originalStyle="" points="" sourceX="165" sourceY="89"
            status="0" style="defaultEdge" targetX="163" targetY="162"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/CommServDBQuery_3/resultSets/row[1]/col[@name=&quot;errorCode&quot;]}==0;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1590419334592" description="performs http operations"
        displayName="Associate VM to Company" height="28"
        interactive="0" jobMode="0" name="HttpClient"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
        uniqueName="HttpClient_10" waitSetting="0" width="178" x="1060" y="24">
        <inputs val="&lt;inputs>&lt;request>&lt;url>/company/xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;companyId&quot;]}/company-association&lt;/url>&lt;method>PUT&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>&amp;lt;Api_AssociateCompanyReq&amp;gt;&amp;lt;entities clientName=&quot;xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmClientname&quot;]}&quot; clientId=&quot;xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmClientId&quot;]}&quot; _type_=&quot;3&quot; /&amp;gt;&amp;lt;/Api_AssociateCompanyReq&amp;gt;&lt;/postContent>&lt;postContentType>application/xml; charset=UTF-8&lt;/postContentType>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/xml&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
        <transition activity="ExecuteScript_1" commented="0"
            originalStyle="" points="" sourceX="949" sourceY="158"
            status="0" style="defaultEdge" targetX="1025" targetY="81"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;(xpath:{/workflow/inputs/contentLibrary}==null || xpath:{/workflow/inputs/contentLibrary}.isEmpty());"/>
        </transition>
        <transition activity="Docking_XML" commented="0"
            originalStyle="" points="" sourceX="1149" sourceY="38"
            status="0" style="defaultEdge" targetX="1102" targetY="98"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;(xpath:{/workflow/inputs/contentLibrary}!=null &amp;&amp; !xpath:{/workflow/inputs/contentLibrary}.isEmpty());"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1590573063885"
        description="This operation used to execute script on guest os in the provided VM"
        displayName="Disable Firewall on the node if there is no CV Firewall set"
        height="42" interactive="0" jobMode="0" maxRestarts="5"
        name="ExecuteScriptInGuestOS"
        namespaceUri="commvault.cte.workflow.activities.VMUtilities"
        originalStyle="" restartInterval="1" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.VMUtilities.ExecuteScriptInGuestOS"
        uniqueName="ExecuteScriptInGuestOS_FW" waitSetting="0"
        width="200" x="1625" y="69">
        <onExit language="1" script="if(xpath:{/workflow/ExecuteScriptInGuestOS_1/errorCode}!=0 || xpath:{/workflow/ExecuteScriptInGuestOS_1/exitCode}!=0)&#xd;&#xa;   workflow.setVariable(&quot;failureMessage&quot;,&quot;Failed to run &quot;);"/>
        <inputs val="&lt;inputs>&lt;vmClientName class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientId class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot; />&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;hostName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;displayName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;commCellName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;csGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;type class=&quot;commvault.msgs.CvEntities.CommCellType&quot; _list_=&quot;false&quot; />&lt;flags class=&quot;commvault.msgs.CvEntities.EntityFlags&quot; _list_=&quot;false&quot; />&lt;GUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;newName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/vmClientName>&lt;vmName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/inputs/vmName}&lt;/vmName>&lt;vmGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmGUID&quot;]}&lt;/vmGUID>&lt;virtualizationClient class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;hypervisorName&quot;]}&lt;/virtualizationClient>&lt;isUNCPath class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>false&lt;/isUNCPath>&lt;scriptPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/scriptPath_FW}&lt;/scriptPath>&lt;scriptLog class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/scriptLogPath_FW}&lt;/scriptLog>&lt;uncPathUserName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;uncPathPassword class=&quot;workflow.types.EncryptedString&quot; _list_=&quot;false&quot; />&lt;guestOSUserName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&quot;vmUsername&quot;]}&lt;/guestOSUserName>&lt;guestOSPassword class=&quot;workflow.types.EncryptedString&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/vmPassword}&lt;/guestOSPassword>&lt;vsaProxyClient class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vsaProxy&quot;]}&lt;/vsaProxyClient>&lt;timeOutInSeconds class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot;>480&lt;/timeOutInSeconds>&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="XPathQuery_28" commented="0"
            originalStyle="" points="" sourceX="1660" sourceY="132"
            status="0" style="defaultEdge" targetX="1493" targetY="250"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1590574088254"
        description="retrieves a list of values from xml"
        displayName="Get ErrorCode" height="34" interactive="0"
        jobMode="0" name="XPathQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=XPathQuery"
        uniqueName="XPathQuery_28" waitSetting="0" width="133" x="1637" y="150">
        <inputs val="&lt;inputs>&lt;xml class=&quot;java.lang.String&quot;>xpath:{/workflow/ExecuteScriptInGuestOS_FW/commandOutput}&lt;/xml>&lt;xpath class=&quot;java.lang.String&quot;>/TMMsg_GenericResp/errorCode&lt;/xpath>&lt;outputType class=&quot;workflow.types.SimpleType&quot;>Integer&lt;/outputType>&lt;outputAsList class=&quot;java.lang.Boolean&quot;>false&lt;/outputAsList>&lt;/inputs>"/>
        <transition activity="XPathQuery_29" commented="0"
            originalStyle="" points="" sourceX="1493" sourceY="250"
            status="0" style="defaultEdge" targetX="1486" targetY="310"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1590574088274"
        description="retrieves a list of values from xml"
        displayName="Get ErrorMessage" height="34" interactive="0"
        jobMode="0" name="XPathQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=XPathQuery"
        uniqueName="XPathQuery_29" waitSetting="0" width="133" x="1635" y="225">
        <onExit language="1" script="if(xpath:{/workflow/XPathQuery_26/result}!=0){&#xd;&#xa;    if(xpath:{/workflow/XPathQuery_25/result}!=null &amp;&amp; xpath:{/workflow/XPathQuery_25/result}.length() > 0){&#xd;&#xa;       workflow.setVariable(&quot;failureMessage&quot;,xpath:{/workflow/XPathQuery_25/result});&#xd;&#xa;    }else{&#xd;&#xa;       workflow.setVariable(&quot;failureMessage&quot;,&quot;Failed to register client to commserve at guest os&quot;);&#xd;&#xa;    }&#xd;&#xa;}&#xd;&#xa;"/>
        <inputs val="&lt;inputs>&lt;xml class=&quot;java.lang.String&quot;>xpath:{/workflow/ExecuteScriptInGuestOS_FW/commandOutput}&lt;/xml>&lt;xpath class=&quot;java.lang.String&quot;>/TMMsg_GenericResp/errorMessage&lt;/xpath>&lt;outputType class=&quot;workflow.types.SimpleType&quot;>String&lt;/outputType>&lt;outputAsList class=&quot;java.lang.Boolean&quot;>false&lt;/outputAsList>&lt;/inputs>"/>
        <transition activity="Email_3" commented="0"
            displayName="Success" originalStyle="" points=""
            sourceX="1486" sourceY="310" status="0" style="defaultEdge"
            targetX="1586" targetY="355" transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScriptInGuestOS_FW/exitCode}==0 &amp;&amp; xpath:{/workflow/XPathQuery_28/result}==0;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1590574638881"
        description="Execute a script on a remote machine"
        displayName="Prepare FW Script" height="34" interactive="0"
        jobMode="0" maxRestarts="0" name="ExecuteScript"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ExecuteScript"
        uniqueName="ExecuteScript_6" waitSetting="0" width="141"
        x="1355" y="73">
        <inputs val="&lt;inputs>&lt;client class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vsaProxy&quot;]}&lt;/client>&lt;impersonateUserName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;impersonateUserPassword class=&quot;workflow.types.EncryptedString&quot; _list_=&quot;false&quot; />&lt;startUpPath class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;scriptType class=&quot;commvault.msgs.App.ScriptType&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;scriptType&quot;]}&lt;/scriptType>&lt;script class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/firewallStop} &amp;gt; xpath:{/workflow/variables/scriptPath_FW}&lt;/script>&lt;arguments class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;waitForProcessCompletion class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/waitForProcessCompletion>&lt;/inputs>"/>
        <transition activity="ExecuteScriptInGuestOS_FW" commented="0"
            displayName="Success" originalStyle="" points=""
            sourceX="1355" sourceY="85" status="0" style="defaultEdge"
            targetX="1661" targetY="129" transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScript_6/exitCode}==0 &amp;&amp; xpath:{/workflow/ExecuteScript_6/errorCode}==0;"/>
        </transition>
        <transition activity="Email_2" commented="0"
            displayName="Failed" offsetX="191" offsetY="-158"
            originalStyle="" points="1419.0,492.0" sourceX="1425"
            sourceY="90" status="0" style="defaultEdge" targetX="1079"
            targetY="358" transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteScript_6/exitCode}!=0 || xpath:{/workflow/ExecuteScript_6/errorCode}!=0;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1614840091570"
        description="creates a super process group"
        displayName="ProcessBlock" height="250" interactive="0"
        jobMode="0" maxRestarts="5" name="ProcessBlock"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" restartInterval="1" skipAttempt="0"
        style="swimlane" uniqueName="ProcessBlock_1" waitSetting="0"
        width="745" x="341" y="544">
        <inputs val="&lt;inputs>&lt;inputs />&lt;/inputs>"/>
        <superProcess>
            <Start commented="0" continueOnFailure="0"
                created="1614840091570" description=""
                displayName="Start" height="30" interactive="0"
                jobMode="0" name="Start" originalStyle=""
                skipAttempt="0"
                style="label;fillColor=#FFFF33;gradientColor=#FFFF00"
                uniqueName="Start_2" waitSetting="0" width="120" x="18" y="30">
                <inputs val="&lt;inputs />"/>
                <transition activity="Script_1" commented="0"
                    originalStyle="" points="" sourceX="78" sourceY="45"
                    status="0" style="defaultEdge" targetX="74"
                    targetY="117" transitionIndex="0" x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Start>
            <Activity commented="0" continueOnFailure="0"
                created="1614840108750"
                description="activity to execute code snippets in the selected language"
                displayName="Encode" height="34" interactive="0"
                jobMode="0" name="Script"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.ScriptActivity"
                uniqueName="Script_1" waitSetting="0" width="100" x="24" y="100">
                <inputs val="&lt;inputs>&lt;script language=&quot;4&quot; script=&quot;&amp;#xD;&amp;#xA;String username= xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;username&amp;quot;]};&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;String password =utils.decryptString(xpath:{/workflow/CommServDBQuery_5/resultSets/row/col});&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;stringToEncode = username+&amp;quot;:&amp;quot;+password;;&amp;#xD;&amp;#xA;encodedString = Base64.getEncoder().encodeToString(stringToEncode.getBytes());&amp;#xD;&amp;#xA;auth = &amp;quot;Basic &amp;quot;+ encodedString;&amp;#xD;&amp;#xA;return auth;&quot; />&lt;/inputs>"/>
                <transition activity="HttpClient_1" commented="0"
                    originalStyle="" points="" sourceX="74"
                    sourceY="117" status="0" style="defaultEdge"
                    targetX="77" targetY="180" transitionIndex="0" x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614840366012"
                description="performs http operations"
                displayName="Login" height="34" interactive="0"
                jobMode="0" maxRestarts="50" name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_1" waitSetting="0" width="100"
                x="26" y="165">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;import java.util.concurrent.TimeUnit;&#xd;&#xa;&#xd;&#xa;JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_1/output});&#xd;&#xa;workflow.setVariable(&quot;sessionId&quot;,jo.get(&quot;value&quot;));&#xd;&#xa;"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/com/vmware/cis/session&lt;/url>&lt;method>POST&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>&lt;/postContent>&lt;postContentType>application/xml; charset=UTF-8&lt;/postContentType>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>Authorization&lt;/name>&lt;value>xpath:{/workflow/Script_1/output}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
                <transition activity="HttpClient_2" commented="0"
                    originalStyle="" points="" sourceX="239"
                    sourceY="52" status="0" style="defaultEdge"
                    targetX="238" targetY="108" transitionIndex="0"
                    x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614848664770"
                description="performs http operations"
                displayName="Fetch DC" height="34" interactive="0"
                jobMode="0" maxRestarts="50" name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_2" waitSetting="0" width="100"
                x="178" y="36">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;import java.util.concurrent.TimeUnit;&#xd;&#xa;&#xd;&#xa;JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_2/output});&#xd;&#xa;JSONArray ja = jo.getJSONArray(&quot;value&quot;);&#xd;&#xa;String id = ja.getJSONObject(0).get(&quot;datacenter&quot;);&#xd;&#xa;workflow.setVariable(&quot;datacenterId&quot;,id);&#xd;&#xa;logger.info(workflow.getVariable(&quot;datacenterId&quot;));&#xd;&#xa;"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/vcenter/datacenter&lt;/url>&lt;method>GET&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>&lt;/postContent>&lt;postContentType>application/xml; charset=UTF-8&lt;/postContentType>&lt;parameters>&lt;name>filter.names&lt;/name>&lt;value>xpath:{/workflow/variables/dataCenterName}&lt;/value>&lt;/parameters>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>vmware-api-session-id&lt;/name>&lt;value>xpath:{/workflow/variables/sessionId}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
                <transition activity="HttpClient_3" commented="0"
                    originalStyle="" points="" sourceX="254"
                    sourceY="115" status="0" style="defaultEdge"
                    targetX="368" targetY="98" transitionIndex="0" x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614853696950"
                description="performs http operations"
                displayName="Fetch DS" height="34" interactive="0"
                jobMode="0" maxRestarts="50" name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_3" waitSetting="0" width="100"
                x="173" y="101">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;import java.util.concurrent.TimeUnit;&#xd;&#xa;&#xd;&#xa;JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_3/output});&#xd;&#xa;JSONArray ja = jo.getJSONArray(&quot;value&quot;);&#xd;&#xa;String id = ja.getJSONObject(0).get(&quot;datastore&quot;);&#xd;&#xa;workflow.setVariable(&quot;datastoreId&quot;,id);&#xd;&#xa;logger.info(workflow.getVariable(&quot;datastoreId&quot;));&#xd;&#xa;"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/vcenter/datastore&lt;/url>&lt;method>GET&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>&lt;/postContent>&lt;postContentType>application/xml; charset=UTF-8&lt;/postContentType>&lt;parameters>&lt;name>filter.names&lt;/name>&lt;value>xpath:{/workflow/variables/dataStore}&lt;/value>&lt;/parameters>&lt;parameters>&lt;name>filter.datacenters&lt;/name>&lt;value>xpath:{/workflow/variables/datacenterId}&lt;/value>&lt;/parameters>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>vmware-api-session-id&lt;/name>&lt;value>xpath:{/workflow/variables/sessionId}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
                <transition activity="HttpClient_4" commented="0"
                    originalStyle="" points="" sourceX="366"
                    sourceY="48" status="0" style="defaultEdge"
                    targetX="370" targetY="103" transitionIndex="0"
                    x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614854006739"
                description="performs http operations"
                displayName="Fetch ResourcePool" height="34"
                interactive="0" jobMode="0" maxRestarts="50"
                name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_4" waitSetting="0" width="144"
                x="164" y="162">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;import java.util.concurrent.TimeUnit;&#xd;&#xa;&#xd;&#xa;JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_4/output});&#xd;&#xa;JSONArray ja = jo.getJSONArray(&quot;value&quot;);&#xd;&#xa;String id = ja.getJSONObject(0).get(&quot;resource_pool&quot;);&#xd;&#xa;workflow.setVariable(&quot;resourcepoolId&quot;,id);&#xd;&#xa;logger.info(workflow.getVariable(&quot;resourcepoolId&quot;));&#xd;&#xa;"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/vcenter/resource-pool&lt;/url>&lt;method>GET&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>&lt;/postContent>&lt;postContentType>application/xml; charset=UTF-8&lt;/postContentType>&lt;parameters>&lt;name>filter.names&lt;/name>&lt;value>xpath:{/workflow/variables/resourcePool}&lt;/value>&lt;/parameters>&lt;parameters>&lt;name>filter.datacenters&lt;/name>&lt;value>xpath:{/workflow/variables/datacenterId}&lt;/value>&lt;/parameters>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>vmware-api-session-id&lt;/name>&lt;value>xpath:{/workflow/variables/sessionId}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
                <transition activity="HttpClient_5" commented="0"
                    originalStyle="" points="298.0,117.0" sourceX="384"
                    sourceY="108" status="0" style="defaultEdge"
                    targetX="474" targetY="67" transitionIndex="0" x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614854179289"
                description="performs http operations"
                displayName="Fetch Network" height="34" interactive="0"
                jobMode="0" maxRestarts="50" name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_5" waitSetting="0" width="144"
                x="323" y="37">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;import java.util.concurrent.TimeUnit;&#xd;&#xa;&#xd;&#xa;JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_5/output});&#xd;&#xa;JSONArray ja = jo.getJSONArray(&quot;value&quot;);&#xd;&#xa;String id = ja.getJSONObject(0).get(&quot;network&quot;);&#xd;&#xa;workflow.setVariable(&quot;networkId&quot;,id);&#xd;&#xa;logger.info(workflow.getVariable(&quot;networkId&quot;));&#xd;&#xa;"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/vcenter/network&lt;/url>&lt;method>GET&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>&lt;/postContent>&lt;postContentType>application/xml; charset=UTF-8&lt;/postContentType>&lt;parameters>&lt;name>filter.names&lt;/name>&lt;value>xpath:{/workflow/variables/vmNetwork}&lt;/value>&lt;/parameters>&lt;parameters>&lt;name>filter.datacenters&lt;/name>&lt;value>xpath:{/workflow/variables/datacenterId}&lt;/value>&lt;/parameters>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>vmware-api-session-id&lt;/name>&lt;value>xpath:{/workflow/variables/sessionId}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
                <transition activity="HttpClient_6" commented="0"
                    originalStyle="" points="" sourceX="525"
                    sourceY="49" status="0" style="defaultEdge"
                    targetX="539" targetY="106" transitionIndex="0"
                    x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614855822411"
                description="performs http operations"
                displayName="Fetch Library" height="34" interactive="0"
                jobMode="0" maxRestarts="50" name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_6" waitSetting="0" width="123"
                x="332" y="95">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;import java.util.concurrent.TimeUnit;&#xd;&#xa;&#xd;&#xa;JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_6/output});&#xd;&#xa;ar = jo.get(&quot;value&quot;);&#xd;&#xa;workflow.setVariable(&quot;libraryId&quot;,ar[0]);&#xd;&#xa;logger.info(workflow.getVariable(&quot;libraryId&quot;));&#xd;&#xa;"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/com/vmware/content/library?~action=find&lt;/url>&lt;method>POST&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>{&#xd;&#xa;    &quot;spec&quot;: {&#xd;&#xa;        &quot;name&quot;: &quot;xpath:{/workflow/inputs/contentLibrary}&quot;&#xd;&#xa;    }&#xd;&#xa;}&lt;/postContent>&lt;postContentType>application/json; charset=UTF-8&lt;/postContentType>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>vmware-api-session-id&lt;/name>&lt;value>xpath:{/workflow/variables/sessionId}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
                <transition activity="HttpClient_11" commented="0"
                    originalStyle="" points="" sourceX="393"
                    sourceY="112" status="0" style="defaultEdge"
                    targetX="395" targetY="175" transitionIndex="0"
                    x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614857662199"
                description="performs http operations"
                displayName="Filter" height="34" interactive="0"
                jobMode="0" maxRestarts="50" name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_8" waitSetting="0" width="98"
                x="502" y="35">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;import java.util.concurrent.TimeUnit;&#xd;&#xa;&#xd;&#xa;if(xpath:{/workflow/HttpClient_8/statusCode}==200)&#xd;&#xa;{&#xd;&#xa;    JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_8/output});&#xd;&#xa;    ar = jo.getJSONObject(&quot;value&quot;).get(&quot;storage_groups&quot;);&#xd;&#xa;    workflow.setVariable(&quot;storagegroupKey&quot;,ar[0]);&#xd;&#xa;    logger.info(workflow.getVariable(&quot;storagegroupKey&quot;));&#xd;&#xa;    ar1 = jo.getJSONObject(&quot;value&quot;).get(&quot;networks&quot;);&#xd;&#xa;    workflow.setVariable(&quot;networkKey&quot;,ar1[0]);&#xd;&#xa;    logger.info(workflow.getVariable(&quot;networkKey&quot;));&#xd;&#xa;&#xd;&#xa; }"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/com/vmware/vcenter/ovf/library-item/id:xpath:{/workflow/variables/itemId}&lt;/url>&lt;method>POST&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>{&#xd;&#xa;    &quot;target&quot;: {&#xd;&#xa;        &quot;resource_pool_id&quot;: &quot;xpath:{/workflow/variables/resourcepoolId}&quot;&#xd;&#xa;    }&#xd;&#xa;}&lt;/postContent>&lt;postContentType>application/json; charset=UTF-8&lt;/postContentType>&lt;parameters>&lt;name>~action&lt;/name>&lt;value>filter&lt;/value>&lt;/parameters>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>vmware-api-session-id&lt;/name>&lt;value>xpath:{/workflow/variables/sessionId}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
                <transition activity="HttpClient_9" commented="0"
                    originalStyle="" points="" sourceX="380"
                    sourceY="159" status="0" style="defaultEdge"
                    targetX="256" targetY="151" transitionIndex="0"
                    x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/HttpClient_8/statusCode}==200;"/>
                </transition>
                <transition activity="Delay_2" commented="0"
                    originalStyle="" points="587.0,95.0" sourceX="512"
                    sourceY="61" status="0" style="defaultEdge"
                    targetX="653" targetY="143" transitionIndex="0"
                    x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/HttpClient_8/statusCode}!=200;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614858638645"
                description="performs http operations"
                displayName="Deploy" height="34" interactive="0"
                jobMode="0" maxRestarts="50" name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_9" waitSetting="0" width="98"
                x="490" y="170">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;&#xd;&#xa;if(xpath:{/workflow/HttpClient_9/statusCode}==200)&#xd;&#xa;{&#xd;&#xa;    JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_9/output});&#xd;&#xa;    ar = jo.getJSONObject(&quot;value&quot;).getJSONObject(&quot;resource_id&quot;).get(&quot;id&quot;);&#xd;&#xa;    workflow.setVariable(&quot;vmId&quot;,ar);&#xd;&#xa;    logger.info(workflow.getVariable(&quot;vmId&quot;));&#xd;&#xa;} &#xd;&#xa;else&#xd;&#xa;{&#xd;&#xa;    workflow.setVariable(&quot;failureMessage&quot;, &quot;Could not deploy VM&quot;);&#xd;&#xa;}"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/com/vmware/vcenter/ovf/library-item/id:xpath:{/workflow/variables/itemId}&lt;/url>&lt;method>POST&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>{&#xd;&#xa;    &quot;deployment_spec&quot;: {&#xd;&#xa;        &quot;accept_all_EULA&quot;: true,&#xd;&#xa;        &quot;default_datastore_id&quot;: &quot;xpath:{/workflow/variables/datastoreId}&quot;,&#xd;&#xa;        &quot;name&quot;: &quot;xpath:{/workflow/inputs/vmName}&quot;,&#xd;&#xa;        &quot;network_mappings&quot;: [&#xd;&#xa;            {&#xd;&#xa;                &quot;key&quot; : &quot;xpath:{/workflow/variables/networkKey}&quot;,&#xd;&#xa;                &quot;value&quot;: &quot;xpath:{/workflow/variables/networkId}&quot;&#xd;&#xa;            }&#xd;&#xa;        ],&#xd;&#xa;        &quot;storage_mappings&quot;: [&#xd;&#xa;            {&#xd;&#xa;                 &quot;key&quot;: &quot;xpath:{/workflow/variables/storagegroupKey}&quot;,&#xd;&#xa;                &quot;value&quot;: {&#xd;&#xa;                    &quot;datastore_id&quot;: &quot;xpath:{/workflow/variables/datastoreId}&quot;,&#xd;&#xa;                    &quot;provisioning&quot;: &quot;thin&quot;,&#xd;&#xa;                    &quot;type&quot;: &quot;DATASTORE&quot;&#xd;&#xa;                }&#xd;&#xa;            }&#xd;&#xa;        ],&#xd;&#xa;        &quot;storage_provisioning&quot;: &quot;thin&quot;&#xd;&#xa;    },&#xd;&#xa;    &quot;target&quot;: {&#xd;&#xa;        &quot;resource_pool_id&quot;: &quot;xpath:{/workflow/variables/resourcepoolId}&quot;&#xd;&#xa;    }&#xd;&#xa;}&lt;/postContent>&lt;postContentType>application/json; charset=UTF-8&lt;/postContentType>&lt;parameters>&lt;name>~action&lt;/name>&lt;value>deploy&lt;/value>&lt;/parameters>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>vmware-api-session-id&lt;/name>&lt;value>xpath:{/workflow/variables/sessionId}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614857104523"
                description="performs http operations"
                displayName="Fetch Item" height="34" interactive="0"
                jobMode="0" maxRestarts="50" name="HttpClient"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" restartInterval="1" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
                uniqueName="HttpClient_11" waitSetting="0" width="123"
                x="331" y="156">
                <onExit language="4" script="import org.json.JSONArray;&#xd;&#xa;import org.json.JSONObject;&#xd;&#xa;import java.util.concurrent.TimeUnit;&#xd;&#xa;&#xd;&#xa;JSONObject jo = new JSONObject(xpath:{/workflow/HttpClient_11/output});&#xd;&#xa;ar = jo.get(&quot;value&quot;);&#xd;&#xa;workflow.setVariable(&quot;itemId&quot;,ar[0]);&#xd;&#xa;logger.info(workflow.getVariable(&quot;itemId&quot;));&#xd;&#xa;"/>
                <inputs val="&lt;inputs>&lt;request>&lt;url>https://xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vcentername&quot;]}/rest/com/vmware/content/library/item?~action=find&lt;/url>&lt;method>POST&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>{&#xd;&#xa;    &quot;spec&quot;: {&#xd;&#xa;        &quot;cached&quot;: true,&#xd;&#xa;        &quot;library_id&quot;: &quot;xpath:{/workflow/variables/libraryId}&quot;,&#xd;&#xa;        &quot;name&quot;: &quot;xpath:{/workflow/variables/itemName}&quot;&#xd;&#xa;    }&#xd;&#xa;}&lt;/postContent>&lt;postContentType>application/json; charset=UTF-8&lt;/postContentType>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/json&lt;/value>&lt;/headers>&lt;headers>&lt;name>vmware-api-session-id&lt;/name>&lt;value>xpath:{/workflow/variables/sessionId}&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
                <transition activity="HttpClient_8" commented="0"
                    originalStyle="" points="" sourceX="392"
                    sourceY="173" status="0" style="defaultEdge"
                    targetX="539" targetY="48" transitionIndex="0" x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
            <Activity commented="0" continueOnFailure="0"
                created="1614884037128"
                description="activity to delay the workflow execution in minutes"
                displayName="Delay" height="34" interactive="0"
                jobMode="0" name="Delay"
                namespaceUri="commvault.cte.workflow.activities"
                originalStyle="" skipAttempt="0"
                style="label;image=commvault.cte.workflow.activities.DelayActivity"
                uniqueName="Delay_2" waitSetting="0" width="100" x="617" y="96">
                <inputs val="&lt;inputs>&lt;delayLength class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot;>5&lt;/delayLength>&lt;delayInterval class=&quot;workflow.types.DelayInterval&quot; _list_=&quot;false&quot;>Minutes&lt;/delayInterval>&lt;/inputs>"/>
                <transition activity="HttpClient_8" commented="0"
                    originalStyle="" points="675.0,61.0" sourceX="381"
                    sourceY="221" status="0" style="defaultEdge"
                    targetX="383" targetY="151" transitionIndex="0"
                    x="0" y="0">
                    <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
                </transition>
            </Activity>
        </superProcess>
        <activitySchema>
            <outputs className="" defaultValue="" listType="0"
                name="outputs" type=""/>
            <inputs className="" defaultValue="" listType="0"
                name="inputs" type=""/>
        </activitySchema>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1614878646422"
        description="executes a defined process block within the workflow"
        displayName="Deploy VM From Library" height="34" interactive="0"
        jobMode="0" maxRestarts="50" name="ExecuteProcessBlock"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" restartInterval="1" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ExecuteSuperProcess"
        uniqueName="ExecuteProcessBlock_1" waitSetting="0" width="164"
        x="-3" y="267">
        <inputs val="&lt;inputs>&lt;inputs />&lt;processBlock>ProcessBlock_1&lt;/processBlock>&lt;outputs />&lt;/inputs>"/>
        <activitySchema>
            <outputs name="ProcessBlock_1">
                <children name="Start_2"/>
                <children name="Script_1">
                    <children className="java.lang.Object"
                        inputType="java.lang.Object" name="output" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_1" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_2" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_3" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_4" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_5" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_6" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_8" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_9" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children className="" defaultValue="" listType="0"
                    name="HttpClient_11" type="">
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="output" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="java.lang.Integer" defaultValue=""
                        hidden="0" inputType="java.lang.Integer"
                        listType="0" name="statusCode" type="{http://www.w3.org/2001/XMLSchema}integer"/>
                    <children attribute="0" className="java.lang.String"
                        defaultValue="" hidden="0"
                        inputType="java.lang.String" listType="0"
                        name="statusText" type="{http://www.w3.org/2001/XMLSchema}string"/>
                    <children attribute="0"
                        className="workflow.types.data.DataRow"
                        defaultValue="" hidden="0"
                        inputType="workflow.types.data.DataRow"
                        listType="0" name="headers" type="{workflow.types.data}DataRow">
                        <children attribute="0"
                            className="java.lang.Object" defaultValue=""
                            hidden="0" inputType="java.lang.Object"
                            listType="1" name="col" type="{http://www.w3.org/2001/XMLSchema}anyType"/>
                    </children>
                </children>
                <children name="Delay_2"/>
            </outputs>
            <inputs className="" defaultValue="" listType="0"
                name="inputs" type=""/>
        </activitySchema>
        <transition activity="Script_4" commented="0" originalStyle=""
            points="" sourceX="83" sourceY="261" status="0"
            style="defaultEdge" targetX="124" targetY="321"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteProcessBlock_1/HttpClient_9/statusCode}==200;"/>
        </transition>
        <transition activity="WorkflowEnd_3" commented="0"
            originalStyle="" points="171.0,235.0" sourceX="87"
            sourceY="261" status="0" style="defaultEdge" targetX="354"
            targetY="214" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExecuteProcessBlock_1/HttpClient_9/statusCode}!=200;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1614924276773"
        description="executes queries against a commcell database"
        displayName="Collecting Gateway Details" height="34"
        interactive="0" jobMode="0" name="CommServDBQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.CommServDBQuery"
        uniqueName="CommServDBQuery_4" waitSetting="0" width="180"
        x="464" y="397">
        <onExit language="4" script="workflow.setVariable(&quot;gatewayPort&quot;,xpath:{/workflow/CommServDBQuery_4/resultSets/row/col[1]});&#xd;&#xa;workflow.setVariable(&quot;gatewayHostname&quot;,xpath:{/workflow/CommServDBQuery_4/resultSets/row/col[2]});&#xd;&#xa;workflow.setVariable(&quot;gatewayClientName&quot;,xpath:{/workflow/CommServDBQuery_4/resultSets/row/col[3]});&#xd;&#xa;&#xd;&#xa;if(workflow.getVariable(&quot;gatewayPort&quot;).contains(&quot;NA&quot;))&#xd;&#xa;{&#xd;&#xa;    workflow.setVariable(&quot;enableFirewall&quot;,&quot;False&quot;);&#xd;&#xa;   }&#xd;&#xa; else&#xd;&#xa; {&#xd;&#xa;    workflow.setVariable(&quot;enableFirewall&quot;,&quot;True&quot;);&#xd;&#xa;    }"/>
        <inputs val="&lt;inputs>&lt;commCell />&lt;query>declare @clients INT, @cgid INT, @port nvarchar(max)&amp;#xD;&#xd;&#xa;set @clients = (select count(*) from APP_ClientGroupAssoc where clientGroupId  = (select id from APP_ClientGroup where name = 'xpath:{/workflow/inputs/gatewayClientGroup}')) &amp;#xD;&#xd;&#xa;if (@clients&amp;gt;0)&amp;#xD;&#xd;&#xa;begin&amp;#xD;&#xd;&#xa;set @cgid = (select id from app_clientgroup where name = 'xpath:{/workflow/inputs/gatewayClientGroup}')&amp;#xD;&#xd;&#xa;set @port = (select tunnelconnectionPort from App_FirewallOptions where clientGroupId = @cgid)&amp;#xD;&#xd;&#xa;select @port, net_hostname,name from app_client where id = (select top 1 clientId from APP_ClientGroupAssoc where clientGroupId = @cgid)&amp;#xD;&#xd;&#xa;end&amp;#xD;&#xd;&#xa;else&amp;#xD;&#xd;&#xa;select 'NA','NA','NA'&lt;/query>&lt;/inputs>"/>
        <transition activity="CommServDBQuery_1" commented="0"
            originalStyle="" points="" sourceX="552" sourceY="415"
            status="0" style="defaultEdge" targetX="548" targetY="365"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615189144153"
        description="activity to execute code snippets in the selected language"
        displayName="Retry" height="34" interactive="0" jobMode="0"
        name="Script" namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ScriptActivity"
        uniqueName="Script_5" waitSetting="0" width="100" x="106" y="456">
        <inputs val="&lt;inputs>&lt;script language=&quot;4&quot; script=&quot;if(xpath:{/workflow/Execute_1/outputXml}.contains(&amp;quot;EVGui_VirtualGuestHostList&amp;quot;))&amp;#xD;&amp;#xA;{&amp;#xD;&amp;#xA;    logger.info(&amp;quot;Connection Good&amp;quot;);&amp;#xD;&amp;#xA;    return true;&amp;#xD;&amp;#xA;}&amp;#xD;&amp;#xA;else&amp;#xD;&amp;#xA;{&amp;#xD;&amp;#xA;    logger.info(&amp;quot;Connectivity failed, retrying&amp;quot;);&amp;#xD;&amp;#xA;    loop=workflow.getVariable(&amp;quot;loopcount&amp;quot;);&amp;#xD;&amp;#xA;    loop=loop+1;&amp;#xD;&amp;#xA;    if(loop&amp;gt;50)&amp;#xD;&amp;#xA;    {&amp;#xD;&amp;#xA;        return true;&amp;#xD;&amp;#xA;     }&amp;#xD;&amp;#xA;     else&amp;#xD;&amp;#xA;     {&amp;#xD;&amp;#xA;        workflow.setVariable(&amp;quot;loopcount&amp;quot;,loop);&amp;#xD;&amp;#xA;        return false;&amp;#xD;&amp;#xA;      }&amp;#xD;&amp;#xA; }&quot; />&lt;/inputs>"/>
        <transition activity="XPathQuery_27" commented="0"
            originalStyle="" points="" sourceX="163" sourceY="389"
            status="0" style="defaultEdge" targetX="366" targetY="307"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/Script_5/output};"/>
        </transition>
        <transition activity="Execute_1" commented="0" originalStyle=""
            points="52.0,426.0" sourceX="156" sourceY="473" status="0"
            style="defaultEdge" targetX="133" targetY="420"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;!xpath:{/workflow/Script_5/output};"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615201334084"
        description="This operation used to power on the VM"
        displayName="PowerOn" height="34" interactive="0" jobMode="0"
        maxRestarts="5" name="PowerOn"
        namespaceUri="commvault.cte.workflow.activities.VMUtilities"
        originalStyle="" restartInterval="1" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.VMUtilities.PowerOn"
        uniqueName="PowerOn_1" waitSetting="0" width="100" x="321" y="451">
        <inputs val="&lt;inputs>&lt;vmClientName class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientId class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot; />&lt;clientName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;hostName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;clientGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;displayName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;commCellName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;csGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;type class=&quot;commvault.msgs.CvEntities.CommCellType&quot; _list_=&quot;false&quot; />&lt;flags class=&quot;commvault.msgs.CvEntities.EntityFlags&quot; _list_=&quot;false&quot; />&lt;GUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;newName class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/vmClientName>&lt;vmName class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;vmName&quot;]}&lt;/vmName>&lt;vmGUID class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/XPathQuery_27/result}&lt;/vmGUID>&lt;virtualizationClient class=&quot;commvault.msgs.CvEntities.ClientEntity&quot; _list_=&quot;false&quot;>xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;hypervisorName&quot;]}&lt;/virtualizationClient>&lt;waitForPowerOnComplete class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/waitForPowerOnComplete>&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot; _list_=&quot;false&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;token class=&quot;java.lang.String&quot; _list_=&quot;false&quot; />&lt;/sessionOptions>&lt;/inputs>"/>
        <transition activity="CommServDBQuery_4" commented="0"
            originalStyle="" points="" sourceX="313" sourceY="388"
            status="0" style="defaultEdge" targetX="490" targetY="363"
            transitionIndex="0" x="0" y="0">
            <condition language="1" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615205001983"
        description="executes queries against a commcell database"
        displayName="Decrpt pwd" height="34" interactive="0" jobMode="0"
        name="CommServDBQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.CommServDBQuery"
        uniqueName="CommServDBQuery_5" waitSetting="0" width="100"
        x="138" y="132">
        <inputs val="&lt;inputs>&lt;commCell />&lt;query>use CommServ&amp;#xD;&#xd;&#xa;&amp;#xD;&#xd;&#xa;DECLARE @v3Password NVARCHAR(MAX) = dbo.pswConvertV5ToV3('xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&quot;password&quot;]}');&amp;#xD;&#xd;&#xa;SELECT @v3Password&lt;/query>&lt;/inputs>"/>
        <transition activity="Script_3" commented="0" originalStyle=""
            points="" sourceX="269" sourceY="157" status="0"
            style="defaultEdge" targetX="175" targetY="207"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615298871973"
        description="executes queries against a commcell database"
        displayName="Verify SimPackageId" height="34" interactive="0"
        jobMode="0" name="CommServDBQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.CommServDBQuery"
        uniqueName="CommServDBQuery_6" waitSetting="0" width="155"
        x="1262" y="357">
        <inputs val="&lt;inputs>&lt;commCell />&lt;query>select ClientId from simInstalledPackages where ClientId = (select id from app_client where GUID = 'xpath:{/workflow/XPathQuery_27/result}') and simPackageID =1136&lt;/query>&lt;/inputs>"/>
        <transition activity="Delay_3" commented="0"
            displayName="Passed" originalStyle="" points=""
            sourceX="1324" sourceY="368" status="0" style="defaultEdge"
            targetX="1330" targetY="453" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/CommServDBQuery_6/resultSets/rowCount}>0;"/>
        </transition>
        <transition activity="Email_2" commented="0"
            displayName="Failed" originalStyle="" points=""
            sourceX="1442" sourceY="260" status="0" style="defaultEdge"
            targetX="1097" targetY="358" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/CommServDBQuery_6/resultSets/rowCount}==0;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615318042316" description="performs http operations"
        displayName="CCR" height="34" interactive="0" jobMode="0"
        name="HttpClient"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.HttpClientActivity"
        uniqueName="HttpClient_12" waitSetting="0" width="100" x="1112" y="422">
        <inputs val="&lt;inputs>&lt;request>&lt;url>/Client/xpath:{/workflow/CommServDBQuery_6/resultSets/row/col}/CheckReadiness?network=true&amp;amp;resourceCapacity=true&amp;amp;includeDisabledClients=true&amp;amp;NeedXmlResp=true&amp;amp;ApplicationReadinessOption=1&lt;/url>&lt;method>GET&lt;/method>&lt;postType>Raw&lt;/postType>&lt;postContent>&lt;/postContent>&lt;postContentType>application/xml; charset=UTF-8&lt;/postContentType>&lt;headers>&lt;name>Authtoken&lt;/name>&lt;value>QSDKONLY xpath:{/workflow/system/token}&lt;/value>&lt;/headers>&lt;headers>&lt;name>Accept&lt;/name>&lt;value>application/xml&lt;/value>&lt;/headers>&lt;/request>&lt;/inputs>"/>
        <transition activity="XPathQuery_30" commented="0"
            originalStyle="" points="" sourceX="1306" sourceY="441"
            status="0" style="defaultEdge" targetX="1153" targetY="442"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615318198590"
        description="retrieves a list of values from xml"
        displayName="CCR Response" height="34" interactive="0"
        jobMode="0" name="XPathQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.XMLQueryActivity"
        uniqueName="XPathQuery_30" waitSetting="0" width="114" x="1154" y="506">
        <onExit language="4" script="workflow.setVariable(&quot;CCR&quot;,xpath:{/workflow/XPathQuery_30/result});"/>
        <inputs val="&lt;inputs>&lt;xml class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/HttpClient_12/output}&lt;/xml>&lt;xpath class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>/Rpt_CheckReadinessXmlResp/summary/@status&lt;/xpath>&lt;outputType class=&quot;workflow.types.SimpleType&quot; _list_=&quot;false&quot;>String&lt;/outputType>&lt;outputAsList class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>true&lt;/outputAsList>&lt;/inputs>"/>
        <transition activity="ExistsInList_1" commented="0"
            originalStyle="" points="" sourceX="1153" sourceY="442"
            status="0" style="defaultEdge" targetX="1140" targetY="522"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615318278182"
        description="utility to check to see if a generic type exists in a list"
        displayName="ExistsInList" height="34" interactive="0"
        jobMode="0" name="ExistsInList"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.ListActivityExists"
        uniqueName="ExistsInList_1" waitSetting="0" width="100" x="1173" y="564">
        <inputs val="&lt;inputs>&lt;listToCheck class=&quot;java.lang.String&quot; _list_=&quot;false&quot;>xpath:{/workflow/variables/CCR}&lt;/listToCheck>&lt;itemToCheck class=&quot;java.lang.Object&quot; _list_=&quot;false&quot;>Not Ready.&lt;/itemToCheck>&lt;/inputs>"/>
        <transition activity="Email_2" commented="0"
            displayName="Not ready" originalStyle=""
            points="1032.9113924050632,449.3670886075949" sourceX="1140"
            sourceY="522" status="0" style="defaultEdge" targetX="1058"
            targetY="348" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/ExistsInList_1/exists};"/>
        </transition>
        <transition activity="Email_3" commented="0" displayName="Ready"
            originalStyle="" points="" sourceX="1140" sourceY="522"
            status="0" style="defaultEdge" targetX="1711" targetY="355"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;!xpath:{/workflow/ExistsInList_1/exists};"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="1"
        created="1615359378332" description=""
        displayName="Dock using ShellScript" height="45" interactive="0"
        jobMode="0" maxRestarts="0" name="Execute"
        namespaceUri="commvault.cte.workflow.activities.cmd.operation"
        originalStyle="" skipAttempt="0" style="label;image=Execute"
        uniqueName="Execute_Docking_ShellScript" waitSetting="0"
        width="158" x="1010" y="156">
        <onExit language="1" script="&#xd;&#xa;"/>
        <inputs val="&lt;inputs>&lt;inputXml class=&quot;java.lang.String&quot;>xpath:{/workflow/Docking_XML/output}&lt;/inputXml>&lt;commandArgs class=&quot;java.lang.String&quot; />&lt;sessionOptions class=&quot;workflow.types.cmd.SessionOptions&quot;>&lt;useImpersonatedAccount class=&quot;java.lang.Boolean&quot;>true&lt;/useImpersonatedAccount>&lt;tokenFile class=&quot;java.lang.String&quot; />&lt;token class=&quot;java.lang.String&quot; />&lt;/sessionOptions>&lt;escapeXml class=&quot;java.lang.Boolean&quot; _list_=&quot;false&quot;>false&lt;/escapeXml>&lt;/inputs>"/>
        <transition activity="XPathQuery_32" commented="0"
            originalStyle="" points="" sourceX="1089" sourceY="178"
            status="0" style="defaultEdge" targetX="1093" targetY="227"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1417376363598"
        description="activity to execute code snippets in the selected language"
        displayName="Docking XML" height="38" interactive="0"
        jobMode="0" name="Script"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=Script"
        uniqueName="Docking_XML" waitSetting="0" width="148" x="1018" y="87">
        <inputs val="&lt;inputs>&lt;script language=&quot;1&quot; script=&quot;&amp;#xD;&amp;#xA;String xml=&amp;quot;&amp;quot;;&amp;#xD;&amp;#xA;int jobId=xpath:{/workflow/system/jobId};&amp;#xD;&amp;#xA;String vmName=xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;vmName&amp;quot;]};&amp;#xD;&amp;#xA;String vmGUID=xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;vmGUID&amp;quot;]};&amp;#xD;&amp;#xA;String hypervisorName=xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;hypervisorName&amp;quot;]};&amp;#xD;&amp;#xA;Integer hypervisorClientId=xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;hypervisorClientId&amp;quot;]};&amp;#xD;&amp;#xA;String scriptlogPath=xpath:{/workflow/variables/scriptlogPath};&amp;#xD;&amp;#xA;String scriptPath=&amp;quot;/etc/baseInitShellScript.sh&amp;quot;;&amp;#xD;&amp;#xA;String XmlArguments=xpath:{/workflow/variables/XmlArguments};&amp;#xD;&amp;#xA;String vmUsername=xpath:{/workflow/CommServDBQuery_1/resultSets/row/col[@name=&amp;quot;vmUsername&amp;quot;]};&amp;#xD;&amp;#xA;String vmPassword=xpath:{/workflow/variables/vmPassword};&amp;#xD;&amp;#xA;String vsaProxy=xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;vsaProxy&amp;quot;]};&amp;#xD;&amp;#xA;int vsaproxyClientId=xpath:{/workflow/CommServDBQuery_3/resultSets/row/col[@name=&amp;quot;vsaproxyClientId&amp;quot;]};&amp;#xD;&amp;#xA;int timeOutInSecs = 720;&amp;#xD;&amp;#xA;xml=&amp;quot;&amp;lt;?xml version=\&amp;quot;1.0\&amp;quot; encoding=\&amp;quot;UTF-8\&amp;quot; standalone=\&amp;quot;no\&amp;quot; ?&amp;gt;&amp;quot;;&amp;#xD;&amp;#xA;xml+=&amp;quot;&amp;lt;TMMsg_VMProvisioningOption operationType=\&amp;quot;46\&amp;quot;&amp;gt; &amp;lt;virtualMachineOption flags=\&amp;quot;1\&amp;quot; jobId=\&amp;quot;&amp;quot;+jobId+&amp;quot;\&amp;quot;&amp;gt; &amp;lt;vmInfo vmAllocPolicyId=\&amp;quot;-1\&amp;quot;&amp;gt;&amp;quot;;&amp;#xD;&amp;#xA;xml+=&amp;quot;&amp;lt;vm clientId=\&amp;quot;0\&amp;quot; clientName=\&amp;quot;\&amp;quot; vmName=\&amp;quot;&amp;quot;+vmName+&amp;quot;\&amp;quot; vmGUID=\&amp;quot;&amp;quot;+vmGUID+&amp;quot;\&amp;quot; /&amp;gt;&amp;lt;vmLocation&amp;gt; &amp;lt;virtualizationClient clientId=\&amp;quot;&amp;quot;+hypervisorClientId+&amp;quot;\&amp;quot; clientName=\&amp;quot;&amp;quot;+hypervisorName+&amp;quot;\&amp;quot; /&amp;gt; &amp;lt;/vmLocation&amp;gt;&amp;quot;;&amp;#xD;&amp;#xA;xml+=&amp;quot;&amp;lt;advancedProperties&amp;gt;&amp;lt;guestScript isUNC=\&amp;quot;1\&amp;quot; osType=\&amp;quot;0\&amp;quot; isLocal=\&amp;quot;1\&amp;quot; scriptLog=\&amp;quot;&amp;quot;+scriptlogPath+&amp;quot;\&amp;quot; scriptPath=\&amp;quot;&amp;quot;+scriptPath+&amp;quot;\&amp;quot; arguments=\&amp;quot;&amp;quot;+XmlArguments+&amp;quot;\&amp;quot; timeOutSeconds=\&amp;quot;&amp;quot;+timeOutInSecs+&amp;quot;\&amp;quot; &amp;gt;&amp;quot;;&amp;#xD;&amp;#xA;xml+=&amp;quot;&amp;lt;guestCredentials userName=\&amp;quot;&amp;quot;+vmUsername+&amp;quot;\&amp;quot; password=\&amp;quot;&amp;quot;+vmPassword+&amp;quot;\&amp;quot;/&amp;gt;&amp;quot;;&amp;#xD;&amp;#xA;xml+=&amp;quot;&amp;lt;clientDetails  clientId=\&amp;quot;&amp;quot;+vsaproxyClientId+&amp;quot;\&amp;quot; clientName=\&amp;quot;&amp;quot;+vsaProxy+&amp;quot;\&amp;quot;/&amp;gt;&amp;quot;;&amp;#xD;&amp;#xA;xml+=&amp;quot;&amp;lt;/guestScript&amp;gt;&amp;lt;/advancedProperties&amp;gt;&amp;lt;/vmInfo&amp;gt;&amp;lt;/virtualMachineOption&amp;gt;&amp;lt;/TMMsg_VMProvisioningOption&amp;gt;&amp;quot;;&amp;#xD;&amp;#xA;String logXml = xml.replaceAll(&amp;quot;(password=.*?)(?=&amp;gt;|$)&amp;quot;,&amp;quot;password=*****&amp;quot;);&amp;#xD;&amp;#xA;logger.info(&amp;quot;Docking  XML###&amp;quot;+logXml);&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;return xml;&quot; />&lt;/inputs>"/>
        <transition activity="Execute_Docking_ShellScript" commented="0"
            originalStyle="" points="" sourceX="1092" sourceY="106"
            status="0" style="defaultEdge" targetX="1097" targetY="193"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615367531475"
        description="retrieves a list of values from xml"
        displayName="Parse Docking Status" height="34" interactive="0"
        jobMode="0" name="XPathQuery"
        namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0" style="label;image=XPathQuery"
        uniqueName="XPathQuery_32" waitSetting="0" width="153" x="1021" y="231">
        <onExit language="1" script="if(xpath:{/workflow/XPathQuery_32/result}!=null &amp;&amp; xpath:{/workflow/XPathQuery_32/result}.length() > 0 &amp;&amp; !xpath:{/workflow/XPathQuery_32/result}.equals(&quot;Script Execution failed to launch&quot;)){&#xd;&#xa;       workflow.setVariable(&quot;failureMessage&quot;,xpath:{/workflow/XPathQuery_32/result});&#xd;&#xa;}&#xd;&#xa;&#xd;&#xa;"/>
        <inputs val="&lt;inputs>&lt;xml class=&quot;java.lang.String&quot;>xpath:{/workflow/Execute_Docking_ShellScript/commandOutput}&lt;/xml>&lt;xpath class=&quot;java.lang.String&quot;>/Ida_VMOpResp/resp/errorMessage&lt;/xpath>&lt;outputType class=&quot;workflow.types.SimpleType&quot;>String&lt;/outputType>&lt;outputAsList class=&quot;java.lang.Boolean&quot;>false&lt;/outputAsList>&lt;/inputs>"/>
        <transition activity="Email_2" commented="0"
            displayName="Failed" originalStyle="" points=""
            sourceX="1087" sourceY="248" status="0" style="defaultEdge"
            targetX="1083" targetY="359" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/XPathQuery_32/result}!=null &amp;&amp; xpath:{/workflow/XPathQuery_32/result}.length() > 0 &amp;&amp; !xpath:{/workflow/XPathQuery_32/result}.equals(&quot;Script Execution failed to launch&quot;);"/>
        </transition>
        <transition activity="CommServDBQuery_6" commented="0"
            displayName="Success" originalStyle=""
            points="1135.4430379746834,384.8101265822785" sourceX="1087"
            sourceY="248" status="0" style="defaultEdge" targetX="1297"
            targetY="367" transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;xpath:{/workflow/XPathQuery_32/result}==null || (xpath:{/workflow/XPathQuery_32/result}!=null &amp;&amp; xpath:{/workflow/XPathQuery_32/result}.length() == 0) || (xpath:{/workflow/XPathQuery_32/result}!=null &amp;&amp; xpath:{/workflow/XPathQuery_32/result}.length() > 0 &amp;&amp; xpath:{/workflow/XPathQuery_32/result}.equals(&quot;Script Execution failed to launch&quot;));"/>
        </transition>
    </Activity>
    <Activity commented="0" continueOnFailure="0"
        created="1615453411086"
        description="activity to delay the workflow execution in minutes"
        displayName="Delay" height="34" interactive="0" jobMode="0"
        name="Delay" namespaceUri="commvault.cte.workflow.activities"
        originalStyle="" skipAttempt="0"
        style="label;image=commvault.cte.workflow.activities.DelayActivity"
        uniqueName="Delay_3" waitSetting="0" width="100" x="1256" y="424">
        <inputs val="&lt;inputs>&lt;delayLength class=&quot;java.lang.Integer&quot; _list_=&quot;false&quot;>2&lt;/delayLength>&lt;delayInterval class=&quot;workflow.types.DelayInterval&quot; _list_=&quot;false&quot;>Minutes&lt;/delayInterval>&lt;/inputs>"/>
        <transition activity="HttpClient_12" commented="0"
            originalStyle="" points="" sourceX="1307" sourceY="447"
            status="0" style="defaultEdge" targetX="1177" targetY="444"
            transitionIndex="0" x="0" y="0">
            <condition language="4" script="/*&#xa;The expression should return a boolean. Use the variable name &quot;activity&quot; to refer to the previous activity object. Example:&#xa;activity.exitCode==0;&#xa;*/&#xa;"/>
        </transition>
    </Activity>
    <formProperties css="" formVersion="0" javaScript="" pageMode="0">
        <rules/>
    </formProperties>
</Workflow_WorkflowDefinition>
